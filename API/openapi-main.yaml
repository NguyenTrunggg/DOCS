openapi: 3.1.0
info:
  title: Recipe Management System API
  description: >
    Comprehensive API for Recipe Management System - A complete platform for recipe discovery,
    management, and social interaction.


    ## Key Features

    - User authentication and profile management

    - Recipe creation, search, and AI-powered suggestions  

    - Social features including ratings, comments, and favorites

    - Personal recipe collections and meal planning

    - Administrative oversight and analytics


    ## Architecture

    This API is built with a modular architecture organized by use cases:

    - **UC1**: Authentication & User Management

    - **UC2**: Recipe Search & Discovery  

    - **UC3**: Personal Recipe Management

    - **UC4**: Social Features & Interactions

    - **UC5**: Recipe Collections

    - **UC6**: Meal Planning

    - **Admin Modules**: Administrative functions


    ## Authentication

    All authenticated endpoints require a JWT Bearer token obtained from the login endpoint.


    ## Data Model

    The API is built on a comprehensive Entity-Relationship model ensuring data integrity and
    performance:

    - **Users**: Account management with session tracking

    - **Recipes**: Complete recipe information with ingredients, steps, and media

    - **Social**: Ratings, comments, favorites, and sharing

    - **Collections**: User-organized recipe collections  

    - **Meal Plans**: Structured meal planning with shopping lists

    - **Admin**: Comprehensive administrative oversight
  version: 1.0.0
  contact:
    name: DATN Development Team
    email: support@recipemanagement.com
    url: https://github.com/datn-recipe-management
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: https://recipemanagement.com/terms
servers:
  - url: https://api.recipemanagement.com/v1
    description: Production server
  - url: https://staging-api.recipemanagement.com/v1
    description: Staging server
  - url: http://localhost:3000/api/v1
    description: Development server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint
  parameters:
    PageParam:
      name: page
      in: query
      description: Page number (starts from 1)
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1
    LimitParam:
      name: limit
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20
    UserIdParam:
      name: userId
      in: path
      required: true
      description: User UUID identifier
      schema:
        type: string
        format: uuid
        example: 123e4567-e89b-12d3-a456-426614174000
    RecipeIdParam:
      name: recipeId
      in: path
      required: true
      description: Recipe UUID identifier
      schema:
        type: string
        format: uuid
        example: 987fcdeb-51d2-43a1-b234-567890123456
    CollectionIdParam:
      name: collectionId
      in: path
      required: true
      description: Collection UUID identifier
      schema:
        type: string
        format: uuid
        example: 456e7890-a12b-34c5-d678-901234567890
    MealPlanIdParam:
      name: mealPlanId
      in: path
      required: true
      description: Meal Plan UUID identifier
      schema:
        type: string
        format: uuid
        example: 789a0123-b45c-67d8-e901-234567890123
    StatusParam:
      name: status
      in: query
      description: Filter by status
      schema:
        type: string
        enum:
          - ACTIVE
          - LOCKED
          - PENDING
          - VERIFIED
        example: ACTIVE
    RecipeStatusParam:
      name: status
      in: query
      description: Filter by recipe status
      schema:
        type: string
        enum:
          - DRAFT
          - PENDING
          - APPROVED
          - REJECTED
          - ARCHIVED
        example: APPROVED
    DifficultyParam:
      name: difficulty
      in: query
      description: Filter by recipe difficulty
      schema:
        type: string
        enum:
          - EASY
          - MEDIUM
          - HARD
        example: MEDIUM
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User unique identifier
          example: 123e4567-e89b-12d3-a456-426614174000
        email:
          type: string
          format: email
          description: User email address
          example: user@example.com
        phone:
          type:
            - string
            - "null"
          pattern: ^[0-9]{10,11}$
          description: Phone number (optional)
          example: "0912345678"
        displayName:
          type: string
          minLength: 2
          maxLength: 100
          description: User display name
          example: Nguyễn Văn A
        avatarUrl:
          type:
            - string
            - "null"
          format: uri
          description: Profile avatar URL
          example: https://example.com/avatars/user123.jpg
        status:
          type: string
          enum:
            - PENDING
            - VERIFIED
            - LOCKED
          description: Account status
          example: VERIFIED
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
          example: 2024-01-15T10:30:00Z
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
          example: 2024-01-20T15:45:00Z
        lastLoginAt:
          type:
            - string
            - "null"
          format: date-time
          description: Last login timestamp
          example: 2024-01-20T08:15:00Z
      required:
        - id
        - email
        - displayName
        - status
        - createdAt
        - updatedAt
    UserProfile:
      allOf:
        - $ref: "#/components/schemas/User"
        - type: object
          properties:
            bio:
              type:
                - string
                - "null"
              maxLength: 500
              description: User biography
              example: Passionate home cook and recipe creator
            preferences:
              type: object
              properties:
                dietaryRestrictions:
                  type: array
                  items:
                    type: string
                  description: Dietary restrictions and allergies
                  example:
                    - vegetarian
                    - gluten-free
                favoriteCategories:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: Favorite recipe categories
                  example:
                    - 123e4567-e89b-12d3-a456-426614174001
            stats:
              $ref: "#/components/schemas/UserStats"
    UserStats:
      type: object
      properties:
        recipesCount:
          type: integer
          minimum: 0
          description: Total number of recipes created
          example: 25
        favoritesCount:
          type: integer
          minimum: 0
          description: Total number of favorite recipes
          example: 150
        ratingsGivenCount:
          type: integer
          minimum: 0
          description: Total ratings given by user
          example: 78
        commentsCount:
          type: integer
          minimum: 0
          description: Total comments made
          example: 42
    UserSession:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        token:
          type: string
          description: Session token
        expiresAt:
          type: string
          format: date-time
        ipAddress:
          type:
            - string
            - "null"
          description: Client IP address
        userAgent:
          type:
            - string
            - "null"
          description: Client user agent
        createdAt:
          type: string
          format: date-time
        lastAccessedAt:
          type:
            - string
            - "null"
          format: date-time
        isActive:
          type: boolean
          default: true
      required:
        - id
        - userId
        - token
        - expiresAt
        - createdAt
        - isActive
    Recipe:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Recipe unique identifier
          example: 987fcdeb-51d2-43a1-b234-567890123456
        name:
          type: string
          minLength: 1
          maxLength: 200
          description: Recipe name
          example: Thịt Kho Tàu Truyền Thống
        description:
          type: string
          minLength: 1
          maxLength: 2000
          description: Recipe description
          example: Món thịt kho tàu đậm đà hương vị truyền thống
        thumbnailUrl:
          type:
            - string
            - "null"
          format: uri
          description: Recipe thumbnail image URL
          example: https://example.com/recipes/thit-kho-tau.jpg
        prepTime:
          type: integer
          minimum: 0
          description: Preparation time in minutes
          example: 30
        cookTime:
          type: integer
          minimum: 0
          description: Cooking time in minutes
          example: 90
        difficulty:
          type: string
          enum:
            - EASY
            - MEDIUM
            - HARD
          description: Recipe difficulty level
          example: MEDIUM
        servings:
          type: integer
          minimum: 1
          description: Number of servings
          example: 4
        status:
          type: string
          enum:
            - DRAFT
            - PENDING
            - APPROVED
            - REJECTED
            - ARCHIVED
          description: Recipe approval status
          example: APPROVED
        isPublic:
          type: boolean
          description: Whether recipe is publicly visible
          default: true
        createdBy:
          type: string
          format: uuid
          description: Recipe author user ID
          example: 123e4567-e89b-12d3-a456-426614174000
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
        updatedAt:
          type: string
          format: date-time
          example: 2024-01-20T15:45:00Z
        views:
          type: integer
          minimum: 0
          description: Number of views
          example: 1250
        isDeleted:
          type: boolean
          default: false
        avgRating:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          maximum: 5
          description: Average rating score
          example: 4.5
        ratingCount:
          type: integer
          minimum: 0
          description: Total number of ratings
          example: 89
        favoriteCount:
          type: integer
          minimum: 0
          description: Number of users who favorited this recipe
          example: 234
      required:
        - id
        - name
        - description
        - prepTime
        - cookTime
        - difficulty
        - servings
        - status
        - createdBy
        - createdAt
        - updatedAt
        - views
        - isDeleted
    RecipeDetail:
      allOf:
        - $ref: "#/components/schemas/Recipe"
        - type: object
          properties:
            ingredients:
              type: array
              items:
                $ref: "#/components/schemas/Ingredient"
              description: List of ingredients
            steps:
              type: array
              items:
                $ref: "#/components/schemas/RecipeStep"
              description: Cooking steps
            media:
              type: array
              items:
                $ref: "#/components/schemas/RecipeMedia"
              description: Associated media files
            nutritionalInfo:
              $ref: "#/components/schemas/NutritionalInfo"
            tags:
              type: array
              items:
                type: string
              description: Recipe tags
              example:
                - Vietnamese
                - Traditional
                - Braised
            author:
              $ref: "#/components/schemas/User"
    Ingredient:
      type: object
      properties:
        id:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Ingredient name
          example: Thịt heo ba chỉ
        amount:
          type: number
          format: float
          minimum: 0
          description: Ingredient amount
          example: 500
        unit:
          type: string
          minLength: 1
          maxLength: 20
          description: Measurement unit
          example: gram
        notes:
          type:
            - string
            - "null"
          maxLength: 500
          description: Additional notes
          example: Chọn miếng có vân mỡ đều
        orderIndex:
          type: integer
          minimum: 0
          description: Display order
          example: 1
      required:
        - id
        - recipeId
        - name
        - amount
        - unit
        - orderIndex
    RecipeStep:
      type: object
      properties:
        id:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        stepNumber:
          type: integer
          minimum: 1
          description: Step sequence number
          example: 1
        instruction:
          type: string
          minLength: 1
          maxLength: 1000
          description: Step instruction
          example: Rửa sạch thịt, cắt miếng vừa ăn
        duration:
          type:
            - integer
            - "null"
          minimum: 0
          description: Estimated duration in minutes
          example: 15
      required:
        - id
        - recipeId
        - stepNumber
        - instruction
    RecipeMedia:
      type: object
      properties:
        id:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        stepId:
          type:
            - string
            - "null"
          format: uuid
          description: Associated step ID (nullable for recipe-level media)
        fileUrl:
          type: string
          format: uri
          description: Media file URL
          example: https://example.com/media/recipe-step-1.jpg
        fileType:
          type: string
          enum:
            - IMAGE
            - VIDEO
          description: File type
          example: IMAGE
        fileSize:
          type: integer
          minimum: 1
          description: File size in bytes
          example: 1048576
        fileName:
          type: string
          minLength: 1
          maxLength: 255
          description: Original file name
          example: thit-kho-step1.jpg
        uploadedAt:
          type: string
          format: date-time
      required:
        - id
        - recipeId
        - fileUrl
        - fileType
        - fileSize
        - fileName
        - uploadedAt
    NutritionalInfo:
      type: object
      properties:
        calories:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          example: 320.5
        protein:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          example: 25.2
        carbs:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          example: 15.8
        fat:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          example: 18.3
        fiber:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          example: 3.1
        sugar:
          type:
            - number
            - "null"
          format: float
          minimum: 0
          example: 8.5
    Favorite:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        addedAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
      required:
        - id
        - userId
        - recipeId
        - addedAt
    Rating:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        score:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating score from 1 to 5 stars
          example: 4
        comment:
          type:
            - string
            - "null"
          maxLength: 1000
          description: Optional rating comment
          example: Công thức rất hay, gia đình tôi rất thích!
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type:
            - string
            - "null"
          format: date-time
      required:
        - id
        - userId
        - recipeId
        - score
        - createdAt
    Comment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        content:
          type: string
          minLength: 1
          maxLength: 1000
          description: Comment content
          example: Tôi đã thử làm theo công thức này và rất thành công!
        photos:
          type:
            - array
            - "null"
          items:
            type: string
            format: uri
          description: Attached photo URLs
          example:
            - https://example.com/comments/photo1.jpg
        tags:
          type:
            - array
            - "null"
          items:
            type: string
          description: Quick rating tags
          example:
            - delicious
            - easy-to-follow
        helpfulCount:
          type: integer
          minimum: 0
          description: Number of "helpful" votes
          default: 0
          example: 12
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type:
            - string
            - "null"
          format: date-time
        isDeleted:
          type: boolean
          default: false
      required:
        - id
        - userId
        - recipeId
        - content
        - helpfulCount
        - createdAt
        - isDeleted
    ShareRecord:
      type: object
      properties:
        id:
          type: string
          format: uuid
        recipeId:
          type: string
          format: uuid
        userId:
          type:
            - string
            - "null"
          format: uuid
          description: User who shared (nullable for anonymous shares)
        channel:
          type: string
          enum:
            - FACEBOOK
            - INSTAGRAM
            - TWITTER
            - WHATSAPP
            - EMAIL
            - COPY_LINK
            - QR_CODE
          description: Sharing channel
          example: FACEBOOK
        sharedAt:
          type: string
          format: date-time
        ipAddress:
          type:
            - string
            - "null"
          description: IP address for anonymous shares
          example: 192.168.1.1
      required:
        - id
        - recipeId
        - channel
        - sharedAt
    Collection:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Collection name
          example: Món Chay Yêu Thích
        description:
          type:
            - string
            - "null"
          maxLength: 500
          description: Collection description
          example: Tuyển tập các món chay ngon và bổ dưỡng
        thumbnailUrl:
          type:
            - string
            - "null"
          format: uri
          description: Collection thumbnail
        isPublic:
          type: boolean
          description: Whether collection is publicly visible
          default: false
        userId:
          type: string
          format: uuid
          description: Collection owner
        recipesCount:
          type: integer
          minimum: 0
          description: Number of recipes in collection
          example: 15
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - name
        - isPublic
        - userId
        - recipesCount
        - createdAt
        - updatedAt
    MealPlan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        date:
          type: string
          format: date
          description: Meal plan date
          example: 2024-01-15
        meals:
          type: array
          items:
            $ref: "#/components/schemas/MealPlanEntry"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - userId
        - date
        - meals
        - createdAt
        - updatedAt
    MealPlanEntry:
      type: object
      properties:
        mealType:
          type: string
          enum:
            - BREAKFAST
            - LUNCH
            - DINNER
            - SNACK
          description: Type of meal
          example: LUNCH
        recipeId:
          type: string
          format: uuid
        recipe:
          $ref: "#/components/schemas/Recipe"
        servings:
          type: integer
          minimum: 1
          description: Number of servings planned
          example: 2
        notes:
          type:
            - string
            - "null"
          maxLength: 500
          description: Meal planning notes
          example: Chuẩn bị trước cho cả tuần
      required:
        - mealType
        - recipeId
        - servings
    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Category name
          example: Món Chính
        description:
          type:
            - string
            - "null"
          maxLength: 500
          example: Các món ăn chính trong bữa cơm
        image:
          type:
            - string
            - "null"
          format: uri
        parentId:
          type:
            - string
            - "null"
          format: uuid
          description: Parent category ID for hierarchical structure
        children:
          type: array
          items:
            $ref: "#/components/schemas/Category"
        recipesCount:
          type: integer
          minimum: 0
          description: Number of recipes in this category
          example: 156
      required:
        - id
        - name
        - recipesCount
    SystemIngredient:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Standardized ingredient name
          example: Thịt heo ba chỉ
        category:
          type:
            - string
            - "null"
          description: Ingredient category
          example: Thịt
        unit:
          type: string
          description: Standard measurement unit
          example: gram
        nutritionalInfo:
          $ref: "#/components/schemas/NutritionalInfo"
      required:
        - id
        - name
        - unit
    AuditLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        action:
          type: string
          enum:
            - USER_LOCK
            - USER_UNLOCK
            - USER_VIEW
            - RECIPE_APPROVE
            - RECIPE_REJECT
            - ADMIN_CREATE
            - ADMIN_DELETE
          description: Action performed
          example: USER_LOCK
        actorId:
          type: string
          format: uuid
          description: Admin who performed the action
        targetId:
          type: string
          format: uuid
          description: Target user/entity ID
        details:
          type:
            - object
            - "null"
          description: Additional action details
          example:
            reason: Spam content
            duration: "30"
        timestamp:
          type: string
          format: date-time
      required:
        - id
        - action
        - actorId
        - targetId
        - timestamp
    UserActivity:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        activityType:
          type: string
          enum:
            - RECIPE_CREATE
            - RECIPE_UPDATE
            - COMMENT_POST
            - RATING_GIVE
            - LOGIN
            - LOGOUT
          example: RECIPE_CREATE
        entityType:
          type:
            - string
            - "null"
          example: RECIPE
        entityId:
          type:
            - string
            - "null"
          format: uuid
        metadata:
          type:
            - object
            - "null"
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - userId
        - activityType
        - createdAt
    AdminAccount:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        fullName:
          type: string
          minLength: 2
          maxLength: 100
        role:
          type: string
          enum:
            - ADMIN
            - MODERATOR
            - SUPER_ADMIN
          example: ADMIN
        permissions:
          type: array
          items:
            type: string
          description: List of permissions
          example:
            - user:read
            - user:update
            - recipe:approve
        createdAt:
          type: string
          format: date-time
        lastLogin:
          type:
            - string
            - "null"
          format: date-time
        isActive:
          type: boolean
          default: true
      required:
        - id
        - email
        - fullName
        - role
        - permissions
        - createdAt
        - isActive
    AnalyticsResponse:
      type: object
      properties:
        summary:
          type: object
          properties:
            totalUsers:
              type: integer
              example: 15420
            activeUsers:
              type: integer
              example: 8960
            totalRecipes:
              type: integer
              example: 45200
            approvedRecipes:
              type: integer
              example: 42180
            totalRatings:
              type: integer
              example: 125600
        chartData:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              value:
                type: number
              label:
                type: string
        topItems:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              name:
                type: string
              count:
                type: integer
              percentage:
                type: number
                format: float
      required:
        - summary
        - chartData
        - topItems
    UserRegistrationRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          description: Password (at least 8 characters)
        confirmPassword:
          type: string
          minLength: 8
        fullName:
          type: string
          minLength: 2
          maxLength: 100
        phone:
          type:
            - string
            - "null"
          pattern: ^[0-9]{10,11}$
      required:
        - email
        - password
        - confirmPassword
        - fullName
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
      required:
        - email
        - password
    UpdateProfileRequest:
      type: object
      properties:
        fullName:
          type: string
          minLength: 2
          maxLength: 100
        phone:
          type:
            - string
            - "null"
          pattern: ^[0-9]{10,11}$
        bio:
          type:
            - string
            - "null"
          maxLength: 500
        avatarUrl:
          type:
            - string
            - "null"
          format: uri
        preferences:
          type: object
          properties:
            dietaryRestrictions:
              type: array
              items:
                type: string
            favoriteCategories:
              type: array
              items:
                type: string
                format: uuid
    ChangePasswordRequest:
      type: object
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 8
        confirmNewPassword:
          type: string
          minLength: 8
      required:
        - currentPassword
        - newPassword
        - confirmNewPassword
    CreateRecipeRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 200
        description:
          type: string
          minLength: 1
          maxLength: 2000
        categoryId:
          type: string
          format: uuid
        difficulty:
          type: string
          enum:
            - EASY
            - MEDIUM
            - HARD
        servings:
          type: integer
          minimum: 1
        prepTime:
          type: integer
          minimum: 0
        cookTime:
          type: integer
          minimum: 0
        ingredients:
          type: array
          minItems: 1
          items:
            type: object
            properties:
              name:
                type: string
                minLength: 1
                maxLength: 100
              amount:
                type: number
                format: float
                minimum: 0
              unit:
                type: string
                minLength: 1
                maxLength: 20
              notes:
                type:
                  - string
                  - "null"
                maxLength: 500
              orderIndex:
                type: integer
                minimum: 0
            required:
              - name
              - amount
              - unit
              - orderIndex
        steps:
          type: array
          minItems: 1
          items:
            type: object
            properties:
              stepNumber:
                type: integer
                minimum: 1
              instruction:
                type: string
                minLength: 1
                maxLength: 1000
              duration:
                type:
                  - integer
                  - "null"
                minimum: 0
            required:
              - stepNumber
              - instruction
        tags:
          type: array
          items:
            type: string
        nutritionalInfo:
          $ref: "#/components/schemas/NutritionalInfo"
        isPublic:
          type: boolean
          default: true
      required:
        - name
        - description
        - categoryId
        - difficulty
        - servings
        - prepTime
        - cookTime
        - ingredients
        - steps
    AISuggestionRequest:
      type: object
      properties:
        ingredients:
          type: array
          items:
            type: string
          minItems: 1
          description: Available ingredients
          example:
            - thịt bò
            - khoai tây
            - cà rốt
        preferences:
          type: object
          properties:
            difficulty:
              type: string
              enum:
                - EASY
                - MEDIUM
                - HARD
            cookingTime:
              type: integer
              minimum: 1
              description: Maximum cooking time in minutes
            category:
              type: string
            dietaryRestrictions:
              type: array
              items:
                type: string
      required:
        - ingredients
    RatingRequest:
      type: object
      properties:
        score:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type:
            - string
            - "null"
          maxLength: 1000
      required:
        - score
    CommentRequest:
      type: object
      properties:
        content:
          type: string
          minLength: 1
          maxLength: 1000
        photos:
          type:
            - array
            - "null"
          items:
            type: string
            format: uri
        tags:
          type:
            - array
            - "null"
          items:
            type: string
      required:
        - content
    CreateCollectionRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type:
            - string
            - "null"
          maxLength: 500
        isPublic:
          type: boolean
          default: false
        thumbnailUrl:
          type:
            - string
            - "null"
          format: uri
      required:
        - name
    CreateMealPlanRequest:
      type: object
      properties:
        date:
          type: string
          format: date
        meals:
          type: array
          items:
            type: object
            properties:
              mealType:
                type: string
                enum:
                  - BREAKFAST
                  - LUNCH
                  - DINNER
                  - SNACK
              recipeId:
                type: string
                format: uuid
              servings:
                type: integer
                minimum: 1
              notes:
                type:
                  - string
                  - "null"
                maxLength: 500
            required:
              - mealType
              - recipeId
              - servings
      required:
        - date
        - meals
    DeactivateUserRequest:
      type: object
      properties:
        reason:
          type: string
          minLength: 10
          maxLength: 500
        duration:
          type:
            - integer
            - "null"
          minimum: 1
          description: Lock duration in days (null for permanent)
      required:
        - reason
    CreateAdminRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        fullName:
          type: string
          minLength: 2
          maxLength: 100
        role:
          type: string
          enum:
            - ADMIN
            - MODERATOR
        password:
          type: string
          minLength: 8
        permissions:
          type: array
          items:
            type: string
      required:
        - email
        - fullName
        - role
        - password
        - permissions
    CreateCategoryRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type:
            - string
            - "null"
          maxLength: 500
        parentId:
          type:
            - string
            - "null"
          format: uuid
        image:
          type:
            - string
            - "null"
          format: uri
      required:
        - name
    CreateIngredientRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        category:
          type:
            - string
            - "null"
        unit:
          type: string
          minLength: 1
          maxLength: 20
        nutritionalInfo:
          $ref: "#/components/schemas/NutritionalInfo"
      required:
        - name
        - unit
    Pagination:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
        limit:
          type: integer
          minimum: 1
          maximum: 100
        total:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 0
        hasNext:
          type: boolean
        hasPrevious:
          type: boolean
      required:
        - page
        - limit
        - total
        - totalPages
        - hasNext
        - hasPrevious
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation completed successfully
        data:
          type:
            - object
            - "null"
      required:
        - success
        - message
    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            user:
              $ref: "#/components/schemas/User"
            token:
              type: string
              description: JWT access token
            refreshToken:
              type: string
              description: Refresh token
            expiresIn:
              type: integer
              description: Token expiration time in seconds
      required:
        - success
        - data
    UserListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            users:
              type: array
              items:
                $ref: "#/components/schemas/User"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    RecipeListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            recipes:
              type: array
              items:
                $ref: "#/components/schemas/Recipe"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    CollectionListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            collections:
              type: array
              items:
                $ref: "#/components/schemas/Collection"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    MealPlanResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: "#/components/schemas/MealPlan"
      required:
        - success
        - data
    MealPlanListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            mealPlans:
              type: array
              items:
                $ref: "#/components/schemas/MealPlan"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    CategoryListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            categories:
              type: array
              items:
                $ref: "#/components/schemas/Category"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    IngredientListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            ingredients:
              type: array
              items:
                $ref: "#/components/schemas/SystemIngredient"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    AdminAccountListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            accounts:
              type: array
              items:
                $ref: "#/components/schemas/AdminAccount"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    AuditLogListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            logs:
              type: array
              items:
                $ref: "#/components/schemas/AuditLog"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    UserActivityListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            activities:
              type: array
              items:
                $ref: "#/components/schemas/UserActivity"
            pagination:
              $ref: "#/components/schemas/Pagination"
      required:
        - success
        - data
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Invalid input data
            details:
              type:
                - object
                - "null"
              example:
                field: email
                issue: Invalid email format
      required:
        - success
        - error
  responses:
    BadRequest:
      description: Bad Request - Invalid input data
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: BAD_REQUEST
              message: Invalid input data
    Unauthorized:
      description: Unauthorized - Authentication required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: UNAUTHORIZED
              message: Authentication token required
    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: FORBIDDEN
              message: Insufficient permissions for this operation
    NotFound:
      description: Not Found - Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: NOT_FOUND
              message: The requested resource was not found
    Conflict:
      description: Conflict - Resource already exists
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: CONFLICT
              message: Resource already exists
    InternalServerError:
      description: Internal Server Error - Unexpected error occurred
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: INTERNAL_SERVER_ERROR
              message: An unexpected error occurred
tags:
  - name: Authentication
    description: User authentication and session management (UC1)
    externalDocs:
      description: Use Case Documentation
      url: https://docs.recipemanagement.com/use-cases/uc1
  - name: Recipe Search
    description: Recipe discovery and AI suggestions (UC2)
    externalDocs:
      description: Use Case Documentation
      url: https://docs.recipemanagement.com/use-cases/uc2
  - name: Recipe Management
    description: Personal recipe CRUD operations (UC3)
    externalDocs:
      description: Use Case Documentation
      url: https://docs.recipemanagement.com/use-cases/uc3
  - name: Social Features
    description: Ratings, comments, favorites, and sharing (UC4)
    externalDocs:
      description: Use Case Documentation
      url: https://docs.recipemanagement.com/use-cases/uc4
  - name: Collections
    description: Recipe collection management (UC5)
    externalDocs:
      description: Use Case Documentation
      url: https://docs.recipemanagement.com/use-cases/uc5
  - name: Meal Planning
    description: Meal planning and shopping lists (UC6)
    externalDocs:
      description: Use Case Documentation
      url: https://docs.recipemanagement.com/use-cases/uc6
  - name: Admin - Users
    description: Administrative user management (UCA1)
    externalDocs:
      description: Admin Documentation
      url: https://docs.recipemanagement.com/admin/users
  - name: Admin - Recipes
    description: Administrative recipe oversight (UCA2)
    externalDocs:
      description: Admin Documentation
      url: https://docs.recipemanagement.com/admin/recipes
  - name: Admin - Categories
    description: Category and ingredient management (UCA3)
    externalDocs:
      description: Admin Documentation
      url: https://docs.recipemanagement.com/admin/categories
  - name: Admin - System
    description: Administrative system management (UCA4)
    externalDocs:
      description: Admin Documentation
      url: https://docs.recipemanagement.com/admin/system
  - name: Admin - Analytics
    description: Reports and analytics (UCA5)
    externalDocs:
      description: Admin Documentation
      url: https://docs.recipemanagement.com/admin/analytics
paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: UCS01-1 - Register new user account
      description: |
        Register a new user account with email/phone and password.
        Creates USER entity with PENDING status and sends verification token.

        **Business Rules:**
        - Email must be unique in system
        - Phone is optional but must be unique if provided  
        - Password must meet security requirements (min 8 chars)
        - Account starts in PENDING status until email verification

        **ERD Entities:** USER, VERIFICATION_TOKEN
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/UserRegistrationRequest
            examples:
              email_registration:
                summary: Registration with email only
                value:
                  email: nguyen.van.a@example.com
                  password: SecurePass123!
                  confirmPassword: SecurePass123!
                  fullName: Nguyễn Văn A
              phone_registration:
                summary: Registration with email and phone
                value:
                  email: tran.thi.b@example.com
                  password: MyPassword456!
                  confirmPassword: MyPassword456!
                  fullName: Trần Thị B
                  phone: "0912345678"
      responses:
        "201":
          description: Registration successful - verification email sent
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AuthResponse
              example:
                success: true
                data:
                  user:
                    id: 123e4567-e89b-12d3-a456-426614174000
                    email: nguyen.van.a@example.com
                    displayName: Nguyễn Văn A
                    status: PENDING
                    createdAt: 2024-01-15T10:30:00Z
                    updatedAt: 2024-01-15T10:30:00Z
                  token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refreshToken: refresh_token_here
                  expiresIn: 3600
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "409":
          description: Email or phone already exists
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: CONFLICT
                  message: Email address already registered
                  details:
                    field: email
                    value: nguyen.van.a@example.com
      operationId: createAuthRegister
  /auth/login:
    post:
      tags:
        - Authentication
      summary: UCS01-2 - Login to system
      description: |
        Authenticate user with email/password and create session.
        Updates USER.lastLoginAt and creates USER_SESSION record.

        **Business Rules:**
        - Account must be VERIFIED status to login
        - LOCKED accounts cannot login
        - Creates session with configurable expiration (24h default, 30 days if remember=true)
        - Updates last login timestamp

        **ERD Entities:** USER, USER_SESSION
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: ../components.yaml#/components/schemas/LoginRequest
                - type: object
                  properties:
                    remember:
                      type: boolean
                      default: false
                      description: Remember me for extended session (30 days)
            examples:
              standard_login:
                summary: Standard login
                value:
                  email: nguyen.van.a@example.com
                  password: SecurePass123!
              remember_login:
                summary: Login with remember me
                value:
                  email: nguyen.van.a@example.com
                  password: SecurePass123!
                  remember: true
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AuthResponse
              example:
                success: true
                data:
                  user:
                    id: 123e4567-e89b-12d3-a456-426614174000
                    email: nguyen.van.a@example.com
                    displayName: Nguyễn Văn A
                    status: VERIFIED
                    lastLoginAt: 2024-01-20T15:45:00Z
                  token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refreshToken: refresh_token_here
                  expiresIn: 86400
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          description: Invalid credentials or account not verified
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                invalid_credentials:
                  summary: Wrong email/password
                  value:
                    success: false
                    error:
                      code: INVALID_CREDENTIALS
                      message: Invalid email or password
                pending_verification:
                  summary: Account not verified
                  value:
                    success: false
                    error:
                      code: ACCOUNT_PENDING
                      message: Please verify your email address before logging in
                locked_account:
                  summary: Account locked
                  value:
                    success: false
                    error:
                      code: ACCOUNT_LOCKED
                      message: Account has been locked. Please contact support.
      operationId: createAuthLogin
  /auth/logout:
    post:
      tags:
        - Authentication
      summary: UCS01-3 - Logout from system
      description: |
        Logout user and invalidate current session.
        Sets USER_SESSION.isActive = FALSE or deletes session record.

        **Business Rules:**
        - Invalidates current session token
        - Optional: logout from all sessions with ?allSessions=true
        - Token becomes invalid immediately

        **ERD Entities:** USER_SESSION
      security:
        - bearerAuth: []
      parameters:
        - name: allSessions
          in: query
          description: Logout from all sessions
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: Successfully logged out
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: createAuthLogout
  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: |
        Refresh expired access token using refresh token.
        Extends session and returns new access token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: Valid refresh token
              required:
                - refreshToken
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        description: New access token
                      expiresIn:
                        type: integer
                        description: Token expiration in seconds
        "401":
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createAuthRefresh
  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: UCS01-7 - Request password reset
      description: |
        Send password reset email with reset token.
        Creates PASSWORD_RESET_TOKEN and sends email with reset link.

        **Business Rules:**
        - Email must exist and account must be VERIFIED
        - Invalidates any existing reset tokens for user
        - Reset token expires in 24 hours
        - Rate limited to prevent abuse

        **ERD Entities:** USER, PASSWORD_RESET_TOKEN
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  description: Registered email address
              required:
                - email
            example:
              email: nguyen.van.a@example.com
      responses:
        "200":
          description: Password reset email sent (always returns 200 for security)
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: If the email exists, a password reset link has been sent
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "429":
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createAuthForgotPassword
  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: UCS01-7 - Reset password with token
      description: |
        Reset password using valid reset token from email.
        Validates PASSWORD_RESET_TOKEN and updates USER.passwordHash.

        **Business Rules:**
        - Token must be valid and not expired
        - Token can only be used once (sets used=true)
        - New password must meet security requirements
        - Invalidates all user sessions (force re-login)

        **ERD Entities:** USER, PASSWORD_RESET_TOKEN, USER_SESSION
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: Reset token from email
                newPassword:
                  type: string
                  minLength: 8
                  description: New password
                confirmPassword:
                  type: string
                  minLength: 8
                  description: Confirm new password
              required:
                - token
                - newPassword
                - confirmPassword
      responses:
        "200":
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
        "400":
          description: Invalid token or password mismatch
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createAuthResetPassword
  /auth/verify-email:
    post:
      tags:
        - Authentication
      summary: Verify email address
      description: |
        Verify user email with verification token.
        Updates USER.status from PENDING to VERIFIED.

        **ERD Entities:** USER, VERIFICATION_TOKEN
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: Email verification token
              required:
                - token
      responses:
        "200":
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
        "400":
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createAuthVerifyEmail
  /users/profile:
    get:
      tags:
        - Authentication
      summary: UCS01-4 - Get user profile
      description: |
        Get current user's profile information including stats.
        Returns USER entity with embedded UserProfile data and statistics.

        **Business Rules:**
        - Returns current authenticated user's profile
        - Includes aggregated statistics (recipes count, favorites count, etc.)
        - Shows preferences and dietary restrictions

        **ERD Entities:** USER (with embedded UserProfile data)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/UserProfile
              example:
                success: true
                data:
                  id: 123e4567-e89b-12d3-a456-426614174000
                  email: nguyen.van.a@example.com
                  displayName: Nguyễn Văn A
                  avatarUrl: https://example.com/avatars/user123.jpg
                  status: VERIFIED
                  bio: Passionate home cook who loves Vietnamese cuisine
                  preferences:
                    dietaryRestrictions:
                      - vegetarian
                    favoriteCategories:
                      - 123e4567-e89b-12d3-a456-426614174001
                  stats:
                    recipesCount: 25
                    favoritesCount: 150
                    ratingsGivenCount: 78
                    commentsCount: 42
                  createdAt: 2024-01-15T10:30:00Z
                  updatedAt: 2024-01-20T15:45:00Z
                  lastLoginAt: 2024-01-25T08:15:00Z
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getUsersProfile
    put:
      tags:
        - Authentication
      summary: UCS01-5 - Update user profile
      description: |
        Update current user's profile information.
        Updates USER entity fields like displayName, avatarUrl, bio, preferences.

        **Business Rules:**
        - Can update display name, avatar, bio, preferences
        - Email change requires separate verification process
        - Updates updatedAt timestamp automatically

        **ERD Entities:** USER
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/UpdateProfileRequest
            example:
              fullName: Nguyễn Văn An
              bio: Experienced home chef specializing in traditional Vietnamese dishes
              preferences:
                dietaryRestrictions:
                  - vegetarian
                  - gluten-free
                favoriteCategories:
                  - 123e4567-e89b-12d3-a456-426614174001
                  - 123e4567-e89b-12d3-a456-426614174002
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/UserProfile
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: updateUsersProfile
  /users/change-password:
    put:
      tags:
        - Authentication
      summary: UCS01-6 - Change user password
      description: |
        Change user password with current password verification.
        Updates USER.passwordHash and revokes all sessions for security.

        **Business Rules:**
        - Must provide current password for verification
        - New password must meet security requirements
        - Revokes all sessions (forces re-login everywhere)
        - Updates updatedAt timestamp

        **ERD Entities:** USER, USER_SESSION
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/ChangePasswordRequest
            example:
              currentPassword: OldPassword123!
              newPassword: NewSecurePassword456!
              confirmNewPassword: NewSecurePassword456!
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: Password changed successfully. Please login again.
        "400":
          description: Current password incorrect or validation failed
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                wrong_current_password:
                  summary: Current password incorrect
                  value:
                    success: false
                    error:
                      code: INVALID_PASSWORD
                      message: Current password is incorrect
                password_mismatch:
                  summary: New passwords don't match
                  value:
                    success: false
                    error:
                      code: PASSWORD_MISMATCH
                      message: New password confirmation doesn't match
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: updateUsersChangePassword
  /users/sessions:
    get:
      tags:
        - Authentication
      summary: Get active user sessions
      description: |
        Get list of active sessions for current user.
        Shows all USER_SESSION records for security management.

        **ERD Entities:** USER_SESSION
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Active sessions retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        ipAddress:
                          type: string
                        userAgent:
                          type: string
                        createdAt:
                          type: string
                          format: date-time
                        lastAccessedAt:
                          type: string
                          format: date-time
                        isCurrent:
                          type: boolean
                          description: Whether this is the current session
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getUsersSessions
    delete:
      tags:
        - Authentication
      summary: Revoke user sessions
      description: |
        Revoke specific or all user sessions.
        Sets USER_SESSION.isActive = FALSE for specified sessions.
      security:
        - bearerAuth: []
      parameters:
        - name: sessionId
          in: query
          description: Specific session ID to revoke (omit for all sessions)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Sessions revoked successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: deleteUsersSessions
  /recipes/search:
    get:
      tags:
        - Recipe Search
      summary: UCS02-2 - Search recipes by name
      description: |
        Search recipes by name/title with fuzzy matching and full-text search.
        Supports Vietnamese text search with similarity scoring.

        **Business Rules:**
        - Only searches APPROVED recipes (status = 'APPROVED')
        - Uses full-text search with Vietnamese language support
        - Results sorted by relevance score by default
        - Supports filtering and sorting options

        **ERD Entities:** RECIPE, USER, CATEGORY
      parameters:
        - name: q
          in: query
          required: true
          description: Search query (recipe name/title)
          schema:
            type: string
            minLength: 1
            maxLength: 200
          example: thịt kho tàu
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
            format: uuid
        - $ref: ../components.yaml#/components/parameters/DifficultyParam
        - name: maxCookTime
          in: query
          description: Maximum cooking time in minutes
          schema:
            type: integer
            minimum: 1
            example: 60
        - name: minRating
          in: query
          description: Minimum average rating (1-5)
          schema:
            type: number
            format: float
            minimum: 1
            maximum: 5
            example: 4
        - name: sortBy
          in: query
          description: Sort results by
          schema:
            type: string
            enum:
              - relevance
              - rating
              - views
              - createdAt
              - cookTime
            default: relevance
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Search results found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          $ref: ../components.yaml#/components/schemas/Recipe
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      filters:
                        type: object
                        properties:
                          availableCategories:
                            type: array
                            items:
                              $ref: ../components.yaml#/components/schemas/Category
                          difficultyCount:
                            type: object
                            example:
                              EASY: 45
                              MEDIUM: 32
                              HARD: 18
                          avgCookTime:
                            type: number
                            format: float
                            example: 45.5
              example:
                success: true
                data:
                  recipes: []
                  pagination:
                    page: 1
                    limit: 20
                    total: 95
                    totalPages: 5
                    hasNext: true
                    hasPrevious: false
                  filters:
                    availableCategories: []
                    difficultyCount:
                      EASY: 45
                      MEDIUM: 32
                      HARD: 18
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
      operationId: getRecipesSearch
  /recipes/search/by-ingredients:
    post:
      tags:
        - Recipe Search
      summary: UCS02-1 - Search recipes by available ingredients
      description: |
        Search recipes using available ingredients with 3-tier priority algorithm:
        - Priority 1: Recipes containing ALL provided ingredients
        - Priority 2: Recipes containing N-1 ingredients (high match)
        - Priority 3: Recipes needing only 1-2 additional common ingredients

        **Business Rules:**
        - Only searches APPROVED recipes
        - Implements sophisticated ingredient matching algorithm
        - Returns suggestions for missing ingredients
        - Results ranked by ingredient match percentage

        **ERD Entities:** RECIPE, INGREDIENT, USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ingredients:
                  type: array
                  items:
                    type: string
                  minItems: 1
                  maxItems: 20
                  description: Available ingredients
                  example:
                    - thịt bò
                    - khoai tây
                    - cà rốt
                    - hành tây
                preferences:
                  type: object
                  properties:
                    difficulty:
                      type: string
                      enum:
                        - EASY
                        - MEDIUM
                        - HARD
                    maxCookTime:
                      type: integer
                      minimum: 1
                    category:
                      type: string
                      format: uuid
                    excludeIngredients:
                      type: array
                      items:
                        type: string
                      description: Ingredients to avoid
                      example:
                        - đậu phộng
                        - sữa
              required:
                - ingredients
            example:
              ingredients:
                - thịt bò
                - khoai tây
                - cà rốt
              preferences:
                difficulty: MEDIUM
                maxCookTime: 90
      responses:
        "200":
          description: Recipe suggestions found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Recipe
                            - type: object
                              properties:
                                matchScore:
                                  type: number
                                  format: float
                                  minimum: 0
                                  maximum: 1
                                  description: Ingredient match percentage
                                  example: 0.85
                                matchedIngredients:
                                  type: array
                                  items:
                                    type: string
                                  description: Matched ingredients
                                  example:
                                    - thịt bò
                                    - khoai tây
                                missingIngredients:
                                  type: array
                                  items:
                                    type: string
                                  description: Additional ingredients needed
                                  example:
                                    - nước mắm
                                    - đường
                                priority:
                                  type: integer
                                  enum:
                                    - 1
                                    - 2
                                    - 3
                                  description: Priority level (1=highest)
                                  example: 1
                      summary:
                        type: object
                        properties:
                          totalResults:
                            type: integer
                            example: 47
                          priorityCounts:
                            type: object
                            example:
                              "1": 12
                              "2": 23
                              "3": 12
                          suggestedIngredients:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                frequency:
                                  type: integer
                                  description: How often this ingredient appears in suggestions
                            example:
                              - name: nước mắm
                                frequency: 35
                              - name: đường
                                frequency: 28
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
      operationId: createRecipesSearchByIngredients
  /recipes/ai-suggest:
    post:
      tags:
        - Recipe Search
      summary: UCS02-3 - Generate recipe using AI
      description: |
        Generate new recipe using AI when no matching recipes found.
        Creates temporary recipe entry with 24-hour expiration.

        **Business Rules:**
        - Triggered when ingredient search returns no results
        - Calls external AI API (GPT/Claude) with structured prompt
        - Creates temporary RECIPE entry (status = 'AI_GENERATED')
        - Auto-expires after 24 hours
        - User can save to personal recipes

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/AISuggestionRequest
            example:
              ingredients:
                - thịt gà
                - nấm
                - cà rốt
              preferences:
                difficulty: EASY
                cookingTime: 45
                category: Món chính
                dietaryRestrictions:
                  - halal
      responses:
        "200":
          description: AI recipe generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/RecipeDetail
                      - type: object
                        properties:
                          isAIGenerated:
                            type: boolean
                            example: true
                          expiresAt:
                            type: string
                            format: date-time
                            description: When this AI recipe expires
                            example: 2024-01-16T10:30:00Z
                          aiModel:
                            type: string
                            description: AI model used for generation
                            example: gpt-4
                          confidence:
                            type: number
                            format: float
                            minimum: 0
                            maximum: 1
                            description: AI confidence score
                            example: 0.89
              example:
                success: true
                data:
                  id: ai-123e4567-e89b-12d3-a456-426614174000
                  name: Gà Xào Nấm Cà Rốt
                  description: Món gà xào đơn giản với nấm và cà rốt, thích hợp cho bữa cơm gia đình
                  isAIGenerated: true
                  expiresAt: 2024-01-16T10:30:00Z
                  confidence: 0.89
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "503":
          description: AI service unavailable
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: AI_SERVICE_UNAVAILABLE
                  message: AI recipe generation is temporarily unavailable
      operationId: createRecipesAiSuggest
  /recipes/{recipeId}:
    get:
      tags:
        - Recipe Search
      summary: UCS02-5 - Get recipe details
      description: >
        Get complete recipe details including ingredients, steps, ratings, and comments.

        Increments view count and records view in VIEW_HISTORY.


        **Business Rules:**

        - Only shows APPROVED recipes (or user's own recipes)

        - Increments views counter atomically

        - Records view in VIEW_HISTORY for analytics

        - Returns complete recipe with all relationships

        - Includes aggregated rating statistics


        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA, RATING, COMMENT,
        VIEW_HISTORY
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "200":
          description: Recipe details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/RecipeDetail
                      - type: object
                        properties:
                          ratings:
                            type: object
                            properties:
                              average:
                                type: number
                                format: float
                                example: 4.3
                              count:
                                type: integer
                                example: 89
                              distribution:
                                type: object
                                example:
                                  "1": 1
                                  "2": 3
                                  "3": 12
                                  "4": 28
                                  "5": 45
                          recentComments:
                            type: array
                            items:
                              $ref: ../components.yaml#/components/schemas/Comment
                            description: Most recent comments (max 5)
                          relatedRecipes:
                            type: array
                            items:
                              $ref: ../components.yaml#/components/schemas/Recipe
                            description: Similar recipes
                          userInteraction:
                            type:
                              - object
                              - "null"
                            properties:
                              isFavorited:
                                type: boolean
                                description: Whether current user favorited this recipe
                              userRating:
                                type:
                                  - integer
                                  - "null"
                                minimum: 1
                                maximum: 5
                                description: Current user's rating
              example:
                success: true
                data:
                  id: 987fcdeb-51d2-43a1-b234-567890123456
                  name: Thịt Kho Tàu Truyền Thống
                  views: 1251
                  ratings:
                    average: 4.3
                    count: 89
                  userInteraction:
                    isFavorited: true
                    userRating: 5
        "403":
          description: Recipe not approved or access denied
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getRecipesByid
  /recipes/popular:
    get:
      tags:
        - Recipe Search
      summary: Get popular recipes
      description: |
        Get popular recipes based on views, ratings, and recent activity.
        Uses computed popularity score from aggregated metrics.

        **ERD Entities:** RECIPE, VIEW_HISTORY, RATING
      parameters:
        - name: timeframe
          in: query
          description: Popularity timeframe
          schema:
            type: string
            enum:
              - daily
              - weekly
              - monthly
              - all-time
            default: weekly
        - name: category
          in: query
          description: Filter by category
          schema:
            type: string
            format: uuid
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Popular recipes retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Recipe
                            - type: object
                              properties:
                                popularityScore:
                                  type: number
                                  format: float
                                  description: Computed popularity score
                                  example: 87.5
                                trendingRank:
                                  type: integer
                                  description: Rank in trending list
                                  example: 3
      operationId: getRecipesPopular
  /categories:
    get:
      tags:
        - Recipe Search
      summary: Get recipe categories
      description: |
        Get all recipe categories with hierarchical structure and recipe counts.
        Used for filtering and navigation.

        **ERD Entities:** CATEGORY
      parameters:
        - name: includeEmpty
          in: query
          description: Include categories with no recipes
          schema:
            type: boolean
            default: false
        - name: level
          in: query
          description: Category hierarchy level (0=root)
          schema:
            type: integer
            minimum: 0
      responses:
        "200":
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: ../components.yaml#/components/schemas/Category
      operationId: getCategories
  /ingredients/search:
    get:
      tags:
        - Recipe Search
      summary: Search ingredients for autocomplete
      description: |
        Search standardized ingredients for autocomplete suggestions.
        Used in ingredient search forms.

        **ERD Entities:** INGREDIENT (system ingredients)
      parameters:
        - name: q
          in: query
          required: true
          description: Ingredient search query
          schema:
            type: string
            minLength: 1
            maxLength: 100
          example: thịt
        - name: limit
          in: query
          description: Max results to return
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        "200":
          description: Ingredient suggestions found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: Thịt bò
                        category:
                          type: string
                          example: Thịt
                        frequency:
                          type: integer
                          description: Usage frequency in recipes
                          example: 145
              example:
                success: true
                data:
                  - name: Thịt bò
                    category: Thịt
                    frequency: 145
                  - name: Thịt heo
                    category: Thịt
                    frequency: 189
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
      operationId: getIngredientsSearch
  /recipes:
    post:
      tags:
        - Recipe Management
      summary: UCS03-1 - Create new recipe
      description: |
        Create a new recipe with ingredients, steps, and media.
        Recipe starts in DRAFT status and can be submitted for approval.

        **Business Rules:**
        - User must be authenticated and verified
        - Recipe starts with status = 'DRAFT'
        - Must have at least 1 ingredient and 1 step
        - Supports media upload for recipe and individual steps
        - Auto-generates order_index for ingredients and step_number for steps

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateRecipeRequest
            example:
              name: Canh Chua Cá Lóc
              description: Món canh chua truyền thống miền Nam với cá lóc tươi và rau thơm
              categoryId: 123e4567-e89b-12d3-a456-426614174001
              difficulty: MEDIUM
              servings: 4
              prepTime: 20
              cookTime: 30
              ingredients:
                - name: Cá lóc
                  amount: 500
                  unit: gram
                  notes: Cắt khúc vừa ăn
                  orderIndex: 1
                - name: Me
                  amount: 2
                  unit: muỗng canh
                  orderIndex: 2
              steps:
                - stepNumber: 1
                  instruction: Sơ chế cá lóc, rửa sạch và cắt khúc
                  duration: 10
                - stepNumber: 2
                  instruction: Nấu nước me, cho cá vào nấu
                  duration: 20
              tags:
                - Vietnamese
                - Soup
                - Southern
              isPublic: true
          multipart/form-data:
            schema:
              type: object
              properties:
                recipe:
                  $ref: ../components.yaml#/components/schemas/CreateRecipeRequest
                thumbnailImage:
                  type: string
                  format: binary
                  description: Recipe thumbnail image
                stepImages:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Step-by-step images
      responses:
        "201":
          description: Recipe created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/RecipeDetail
              example:
                success: true
                data:
                  id: 987fcdeb-51d2-43a1-b234-567890123456
                  name: Canh Chua Cá Lóc
                  status: DRAFT
                  createdBy: 123e4567-e89b-12d3-a456-426614174000
                  createdAt: 2024-01-15T10:30:00Z
                  ingredients: []
                  steps: []
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                missing_ingredients:
                  summary: Missing required ingredients
                  value:
                    success: false
                    error:
                      code: VALIDATION_ERROR
                      message: Recipe must have at least 1 ingredient
                      details:
                        field: ingredients
                        constraint: minItems
                invalid_difficulty:
                  summary: Invalid difficulty level
                  value:
                    success: false
                    error:
                      code: VALIDATION_ERROR
                      message: Difficulty must be EASY, MEDIUM, or HARD
                      details:
                        field: difficulty
                        value: INVALID
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "413":
          description: File too large
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createRecipes
  /users/recipes:
    get:
      tags:
        - Recipe Management
      summary: UCS03-2 - Get user's recipes
      description: |
        Get list of recipes created by the current user with filtering and stats.
        Shows all recipes regardless of status (DRAFT, PENDING, APPROVED, REJECTED).

        **Business Rules:**
        - Only shows recipes where created_by = current user
        - Includes recipes in all statuses for owner view
        - Supports filtering by status, category, difficulty
        - Provides aggregated statistics

        **ERD Entities:** RECIPE, USER
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeStatusParam
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
            format: uuid
        - $ref: ../components.yaml#/components/parameters/DifficultyParam
        - name: sortBy
          in: query
          description: Sort recipes by
          schema:
            type: string
            enum:
              - createdAt
              - updatedAt
              - name
              - views
              - rating
            default: updatedAt
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: User recipes retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          $ref: ../components.yaml#/components/schemas/Recipe
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      statistics:
                        type: object
                        properties:
                          totalRecipes:
                            type: integer
                            example: 25
                          statusCounts:
                            type: object
                            example:
                              DRAFT: 8
                              PENDING: 3
                              APPROVED: 12
                              REJECTED: 2
                          totalViews:
                            type: integer
                            example: 15420
                          avgRating:
                            type: number
                            format: float
                            example: 4.2
                          totalFavorites:
                            type: integer
                            example: 342
              example:
                success: true
                data:
                  recipes: []
                  pagination:
                    page: 1
                    limit: 20
                    total: 25
                    totalPages: 2
                    hasNext: true
                    hasPrevious: false
                  statistics:
                    totalRecipes: 25
                    statusCounts:
                      DRAFT: 8
                      PENDING: 3
                      APPROVED: 12
                      REJECTED: 2
                    totalViews: 15420
                    avgRating: 4.2
                    totalFavorites: 342
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getUsersRecipes
  /recipes/{recipeId}/edit:
    get:
      tags:
        - Recipe Management
      summary: Get recipe for editing
      description: |
        Get recipe details for editing form.
        Only recipe owner can access this endpoint.

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "200":
          description: Recipe edit data retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/RecipeDetail
                      - type: object
                        properties:
                          editInfo:
                            type: object
                            properties:
                              canEdit:
                                type: boolean
                                description: Whether recipe can be edited
                              canSubmit:
                                type: boolean
                                description: Whether recipe can be submitted for approval
                              canDelete:
                                type: boolean
                                description: Whether recipe can be deleted
                              statusHistory:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    status:
                                      type: string
                                    changedAt:
                                      type: string
                                      format: date-time
                                    reason:
                                      type:
                                        - string
                                        - "null"
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getRecipesByidEdit
    put:
      tags:
        - Recipe Management
      summary: UCS03-3 - Update recipe
      description: |
        Update recipe information, ingredients, steps, and media.
        Only recipe owner can update. Status restrictions apply.

        **Business Rules:**
        - Only recipe owner (created_by) can update
        - APPROVED recipes cannot be edited (must create new version)
        - PENDING recipes can only update media and notes
        - DRAFT recipes can be fully edited
        - Updates updatedAt timestamp automatically

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              allOf:
                - $ref: ../components.yaml#/components/schemas/CreateRecipeRequest
                - type: object
                  properties:
                    submitForApproval:
                      type: boolean
                      default: false
                      description: Submit for approval after update
            example:
              name: Canh Chua Cá Lóc Cải Tiến
              description: Phiên bản cải tiến với thêm dứa và đậu bắp
              ingredients:
                - name: Cá lóc
                  amount: 500
                  unit: gram
                  orderIndex: 1
                - name: Dứa
                  amount: 100
                  unit: gram
                  notes: Cắt múi vừa
                  orderIndex: 2
              submitForApproval: true
          multipart/form-data:
            schema:
              type: object
              properties:
                recipe:
                  type: object
                newThumbnail:
                  type: string
                  format: binary
                newStepImages:
                  type: array
                  items:
                    type: string
                    format: binary
                removeImageIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: IDs of images to remove
      responses:
        "200":
          description: Recipe updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/RecipeDetail
                      - type: object
                        properties:
                          statusChanged:
                            type: boolean
                            description: Whether status was changed
                          newStatus:
                            type:
                              - string
                              - "null"
                            description: New status if changed
        "400":
          description: Update validation error
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                cannot_edit_approved:
                  summary: Cannot edit approved recipe
                  value:
                    success: false
                    error:
                      code: EDIT_NOT_ALLOWED
                      message: Approved recipes cannot be edited. Create a new version instead.
                pending_limited_edit:
                  summary: Limited edit for pending recipe
                  value:
                    success: false
                    error:
                      code: LIMITED_EDIT_ONLY
                      message: Pending recipes can only update media and notes
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateRecipesByidEdit
    delete:
      tags:
        - Recipe Management
      summary: UCS03-4 - Delete recipe
      description: |
        Delete user's recipe with confirmation.
        Uses soft delete to preserve audit trail and references.

        **Business Rules:**
        - Only recipe owner can delete
        - APPROVED recipes cannot be deleted (contact admin)
        - Soft delete: sets is_deleted = TRUE
        - Cascades to ingredients, steps, media cleanup
        - Preserves ratings/comments for data integrity

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
        - name: confirmDelete
          in: query
          required: true
          description: Confirmation flag (must be true)
          schema:
            type: boolean
        - name: reason
          in: query
          description: Reason for deletion (optional)
          schema:
            type: string
            maxLength: 500
      responses:
        "200":
          description: Recipe deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: Recipe deleted successfully
        "400":
          description: Delete validation error
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                no_confirmation:
                  summary: Missing delete confirmation
                  value:
                    success: false
                    error:
                      code: CONFIRMATION_REQUIRED
                      message: Delete confirmation required (confirmDelete=true)
                cannot_delete_approved:
                  summary: Cannot delete approved recipe
                  value:
                    success: false
                    error:
                      code: DELETE_NOT_ALLOWED
                      message: Approved recipes cannot be deleted. Please contact an administrator.
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: deleteRecipesByidEdit
  /recipes/{recipeId}/media:
    get:
      tags:
        - Recipe Management
      summary: Get recipe media files
      description: |
        Get all media files associated with a recipe and its steps.

        **ERD Entities:** RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
        - name: type
          in: query
          description: Filter by media type
          schema:
            type: string
            enum:
              - IMAGE
              - VIDEO
      responses:
        "200":
          description: Recipe media retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipeMedia:
                        type: array
                        items:
                          $ref: ../components.yaml#/components/schemas/RecipeMedia
                        description: Recipe-level media (thumbnails, etc.)
                      stepMedia:
                        type: object
                        additionalProperties:
                          type: array
                          items:
                            $ref: ../components.yaml#/components/schemas/RecipeMedia
                        description: Media organized by step ID
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getRecipesByidMedia
    post:
      tags:
        - Recipe Management
      summary: Upload recipe media
      description: |
        Upload new media files for recipe or specific steps.

        **ERD Entities:** RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  minItems: 1
                  maxItems: 10
                stepId:
                  type: string
                  format: uuid
                  description: Associate with specific step (optional)
                mediaType:
                  type: string
                  enum:
                    - IMAGE
                    - VIDEO
                  default: IMAGE
                descriptions:
                  type: array
                  items:
                    type: string
                  description: Descriptions for each file
              required:
                - files
      responses:
        "201":
          description: Media uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      uploadedMedia:
                        type: array
                        items:
                          $ref: ../components.yaml#/components/schemas/RecipeMedia
                      totalSize:
                        type: integer
                        description: Total upload size in bytes
                      uploadTime:
                        type: number
                        format: float
                        description: Upload processing time in seconds
        "400":
          description: Upload validation error
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "413":
          description: File too large or too many files
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createRecipesByidMedia
    delete:
      tags:
        - Recipe Management
      summary: Delete recipe media
      description: |
        Delete specific media files from recipe.

        **ERD Entities:** RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
        - name: mediaIds
          in: query
          required: true
          description: Comma-separated media IDs to delete
          schema:
            type: string
          example: 123e4567-e89b-12d3-a456-426614174000,987fcdeb-51d2-43a1-b234-567890123456
      responses:
        "200":
          description: Media deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      deletedCount:
                        type: integer
                        example: 2
                      freedSpace:
                        type: integer
                        description: Space freed in bytes
                        example: 2097152
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
      operationId: deleteRecipesByidMedia
  /recipes/{recipeId}/favorite:
    post:
      tags:
        - Social Features
      summary: UCS04-1 - Add recipe to favorites
      description: |
        Add recipe to user's favorites list.
        Creates FAVORITE entity with unique constraint (userId, recipeId).

        **Business Rules:**
        - User must be authenticated
        - Recipe must be APPROVED status
        - Unique constraint: one favorite per user per recipe
        - User can have maximum 500 favorites (business rule)
        - Updates Recipe.favoriteCount counter

        **ERD Entities:** FAVORITE, RECIPE (favoriteCount update)
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "201":
          description: Recipe added to favorites successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/Favorite
              example:
                success: true
                data:
                  id: fav-123e4567-e89b-12d3-a456-426614174000
                  userId: 123e4567-e89b-12d3-a456-426614174000
                  recipeId: 987fcdeb-51d2-43a1-b234-567890123456
                  addedAt: 2024-01-15T10:30:00Z
        "400":
          description: Business rule violation
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                favorites_limit:
                  summary: Favorites limit reached
                  value:
                    success: false
                    error:
                      code: FAVORITES_LIMIT_EXCEEDED
                      message: You can have maximum 500 favorite recipes
                      details:
                        currentCount: 500
                        limit: 500
                recipe_not_approved:
                  summary: Recipe not approved
                  value:
                    success: false
                    error:
                      code: RECIPE_NOT_APPROVED
                      message: Only approved recipes can be favorited
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
        "409":
          description: Recipe already favorited
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: ALREADY_FAVORITED
                  message: This recipe is already in your favorites
      operationId: createRecipesByidFavorite
    delete:
      tags:
        - Social Features
      summary: UCS04-2 - Remove recipe from favorites
      description: |
        Remove recipe from user's favorites list.
        Deletes FAVORITE entity and updates Recipe.favoriteCount.

        **Business Rules:**
        - User can only remove their own favorites
        - Updates Recipe.favoriteCount counter atomically

        **ERD Entities:** FAVORITE, RECIPE (favoriteCount update)
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "200":
          description: Recipe removed from favorites successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: Recipe removed from favorites
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "404":
          description: Recipe not in favorites
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: NOT_FAVORITED
                  message: This recipe is not in your favorites
      operationId: deleteRecipesByidFavorite
  /users/favorites:
    get:
      tags:
        - Social Features
      summary: UCS04-3 - Get user's favorite recipes
      description: |
        Get paginated list of user's favorite recipes with sorting options.
        Joins FAVORITE with RECIPE to return full recipe information.

        **Business Rules:**
        - Shows favorites ordered by addedAt (newest first) by default
        - Only shows APPROVED recipes that are not deleted
        - Supports filtering by category, difficulty

        **ERD Entities:** FAVORITE, RECIPE, CATEGORY
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by recipe category
          schema:
            type: string
            format: uuid
        - $ref: ../components.yaml#/components/parameters/DifficultyParam
        - name: sortBy
          in: query
          description: Sort favorites by
          schema:
            type: string
            enum:
              - addedAt
              - recipeName
              - recipeRating
              - recipeViews
            default: addedAt
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Favorite recipes retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      favorites:
                        type: array
                        items:
                          type: object
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Favorite
                            - type: object
                              properties:
                                recipe:
                                  $ref: ../components.yaml#/components/schemas/Recipe
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      statistics:
                        type: object
                        properties:
                          totalFavorites:
                            type: integer
                            example: 150
                          categoryCounts:
                            type: object
                            example:
                              Món chính: 45
                              Món tráng miệng: 32
                          avgRating:
                            type: number
                            format: float
                            example: 4.3
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getUsersFavorites
  /recipes/{recipeId}/rating:
    post:
      tags:
        - Social Features
      summary: UCS04-4 - Rate recipe
      description: |
        Give rating (1-5 stars) to a recipe with optional comment.
        Uses upsert pattern - creates new or updates existing rating.

        **Business Rules:**
        - User must be authenticated
        - Recipe must be APPROVED status
        - Score must be 1-5 integers
        - Unique constraint: one rating per user per recipe (can update)
        - Updates Recipe.avgRating and ratingCount automatically

        **ERD Entities:** RATING, RECIPE (rating aggregates update)
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/RatingRequest
            example:
              score: 5
              comment: Công thức rất hay! Gia đình tôi rất thích món này. Sẽ làm lại nhiều lần.
      responses:
        "200":
          description: Rating updated successfully (existing rating)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/Rating
                      - type: object
                        properties:
                          isUpdate:
                            type: boolean
                            example: true
                          previousScore:
                            type: integer
                            example: 4
        "201":
          description: Rating submitted successfully (new rating)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/Rating
                      - type: object
                        properties:
                          isUpdate:
                            type: boolean
                            example: false
                          recipeStats:
                            type: object
                            properties:
                              newAvgRating:
                                type: number
                                format: float
                                example: 4.3
                              newRatingCount:
                                type: integer
                                example: 89
        "400":
          description: Invalid rating data
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                invalid_score:
                  summary: Invalid score value
                  value:
                    success: false
                    error:
                      code: INVALID_SCORE
                      message: Rating score must be between 1 and 5
                      details:
                        field: score
                        value: 6
                        constraint: 1-5
                cannot_rate_own:
                  summary: Cannot rate own recipe
                  value:
                    success: false
                    error:
                      code: CANNOT_RATE_OWN_RECIPE
                      message: You cannot rate your own recipe
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: createRecipesByidRating
    get:
      tags:
        - Social Features
      summary: Get user's rating for recipe
      description: |
        Get current user's rating for specific recipe.
        Returns null if user hasn't rated the recipe.
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "200":
          description: User rating retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/Rating
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getRecipesByidRating
  /recipes/{recipeId}/comments:
    get:
      tags:
        - Social Features
      summary: UCS04-5 - Get recipe comments
      description: |
        Get paginated comments for a recipe with sorting options.
        Includes user information and helpful counts.

        **Business Rules:**
        - Shows non-deleted comments only (is_deleted = FALSE)
        - Default sort by helpful count (most helpful first)
        - Includes user display name and avatar

        **ERD Entities:** COMMENT, USER
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
        - name: sortBy
          in: query
          description: Sort comments by
          schema:
            type: string
            enum:
              - createdAt
              - helpfulCount
              - rating
            default: helpfulCount
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      comments:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Comment
                            - type: object
                              properties:
                                user:
                                  type: object
                                  properties:
                                    id:
                                      type: string
                                      format: uuid
                                    displayName:
                                      type: string
                                    avatarUrl:
                                      type:
                                        - string
                                        - "null"
                                      format: uri
                                userRating:
                                  type:
                                    - integer
                                    - "null"
                                  minimum: 1
                                  maximum: 5
                                  description: User's rating for this recipe
                                canEdit:
                                  type: boolean
                                  description: Whether current user can edit this comment
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      summary:
                        type: object
                        properties:
                          totalComments:
                            type: integer
                            example: 142
                          avgHelpfulScore:
                            type: number
                            format: float
                            example: 3.2
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getRecipesByidComments
    post:
      tags:
        - Social Features
      summary: UCS04-4 - Add comment to recipe
      description: |
        Add a new comment to recipe with optional photos and tags.
        User can comment multiple times on same recipe.

        **Business Rules:**
        - User must be authenticated
        - Recipe must be APPROVED status
        - Comment content required (1-1000 chars)
        - Photos optional (max 5 images)
        - Tags optional for quick feedback

        **ERD Entities:** COMMENT
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CommentRequest
            example:
              content: Tôi đã thử làm theo công thức này và rất thành công! Gia đình ai cũng khen ngon.
              photos:
                - https://example.com/my-result1.jpg
                - https://example.com/my-result2.jpg
              tags:
                - delicious
                - easy-to-follow
                - family-approved
          multipart/form-data:
            schema:
              type: object
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
                photos:
                  type: array
                  items:
                    type: string
                    format: binary
                  maxItems: 5
                tags:
                  type: array
                  items:
                    type: string
              required:
                - content
      responses:
        "201":
          description: Comment added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/Comment
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
        "413":
          description: Photos too large
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createRecipesByidComments
  /comments/{commentId}/helpful:
    post:
      tags:
        - Social Features
      summary: Mark comment as helpful
      description: |
        Mark a comment as helpful. Increments helpfulCount.
        Users can only mark each comment helpful once.
      security:
        - bearerAuth: []
      parameters:
        - name: commentId
          in: path
          required: true
          description: Comment UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Comment marked as helpful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      newHelpfulCount:
                        type: integer
                        example: 13
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
        "409":
          description: Already marked as helpful
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createCommentsByidHelpful
  /recipes/{recipeId}/share:
    post:
      tags:
        - Social Features
      summary: UCS04-6 - Share recipe
      description: |
        Share recipe through various channels and track sharing activity.
        Creates SHARE_RECORD for analytics and supports anonymous sharing.

        **Business Rules:**
        - Recipe must be APPROVED status
        - Supports both authenticated and anonymous sharing
        - Records sharing statistics for analytics
        - Different channels may have different requirements

        **ERD Entities:** SHARE_RECORD, RECIPE
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                channel:
                  type: string
                  enum:
                    - FACEBOOK
                    - INSTAGRAM
                    - TWITTER
                    - WHATSAPP
                    - EMAIL
                    - COPY_LINK
                    - QR_CODE
                  description: Sharing channel
                recipients:
                  type: array
                  items:
                    type: string
                  description: Email addresses (for EMAIL channel)
                  maxItems: 10
                message:
                  type: string
                  maxLength: 500
                  description: Custom message (optional)
              required:
                - channel
            example:
              channel: FACEBOOK
              message: Thử món này nhé, rất ngon!
      responses:
        "200":
          description: Recipe shared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      shareRecord:
                        $ref: ../components.yaml#/components/schemas/ShareRecord
                      shareUrl:
                        type: string
                        format: uri
                        description: Generated share URL
                        example: https://recipeapp.com/recipes/987fcdeb?share=fb123
                      qrCode:
                        type:
                          - string
                          - "null"
                        description: Base64 QR code (for QR_CODE channel)
              example:
                success: true
                data:
                  shareRecord:
                    id: share-123e4567-e89b-12d3-a456-426614174000
                    recipeId: 987fcdeb-51d2-43a1-b234-567890123456
                    channel: FACEBOOK
                    sharedAt: 2024-01-15T10:30:00Z
                  shareUrl: https://recipeapp.com/recipes/987fcdeb?share=fb123
        "400":
          description: Invalid share request
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                invalid_email_channel:
                  summary: Email channel requires recipients
                  value:
                    success: false
                    error:
                      code: MISSING_RECIPIENTS
                      message: Email sharing requires at least one recipient
                too_many_recipients:
                  summary: Too many email recipients
                  value:
                    success: false
                    error:
                      code: TOO_MANY_RECIPIENTS
                      message: Maximum 10 email recipients allowed
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
        "429":
          description: Share rate limit exceeded
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
      operationId: createRecipesByidShare
  /share/channels:
    get:
      tags:
        - Social Features
      summary: Get available share channels
      description: |
        Get list of available sharing channels with their configuration.
        Used to populate sharing UI options.

        **ERD Entities:** SHARE_CHANNEL
      responses:
        "200":
          description: Share channels retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: FACEBOOK
                        displayName:
                          type: string
                          example: Facebook
                        iconUrl:
                          type: string
                          format: uri
                          example: https://cdn.example.com/icons/facebook.svg
                        isActive:
                          type: boolean
                          example: true
                        description:
                          type: string
                          example: Share to your Facebook timeline
                        requiresAuth:
                          type: boolean
                          example: false
                          description: Whether this channel requires user authentication
      operationId: getShareChannels
  /collections:
    get:
      tags:
        - Collections
      summary: UCS05-1 - Get user's collections
      description: |
        Get paginated list of collections owned by current user.
        Includes collection statistics and preview recipes.

        **Business Rules:**
        - Shows only collections owned by current user
        - Includes recipe count and preview thumbnails
        - Supports filtering by public/private status
        - Default sort by updatedAt (most recently updated first)

        **ERD Entities:** COLLECTION, RECIPE (for previews)
      security:
        - bearerAuth: []
      parameters:
        - name: visibility
          in: query
          description: Filter by collection visibility
          schema:
            type: string
            enum:
              - public
              - private
              - all
            default: all
        - name: sortBy
          in: query
          description: Sort collections by
          schema:
            type: string
            enum:
              - createdAt
              - updatedAt
              - name
              - recipesCount
            default: updatedAt
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Collections retrieved successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/CollectionListResponse
              example:
                success: true
                data:
                  collections:
                    - id: col-123e4567-e89b-12d3-a456-426614174000
                      name: Món Chay Yêu Thích
                      description: Tuyển tập các món chay ngon và bổ dưỡng
                      isPublic: false
                      recipesCount: 15
                      thumbnailUrl: https://example.com/collections/col123-thumb.jpg
                      createdAt: 2024-01-10T10:00:00Z
                      updatedAt: 2024-01-20T15:30:00Z
                      previewRecipes:
                        - id: rec1
                          name: Đậu hũ sốt cà
                          thumbnailUrl: https://example.com/recipes/rec1-thumb.jpg
                  pagination:
                    page: 1
                    limit: 20
                    total: 8
                    totalPages: 1
                    hasNext: false
                    hasPrevious: false
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getCollections
    post:
      tags:
        - Collections
      summary: UCS05-2 - Create new collection
      description: |
        Create a new recipe collection.
        Collection starts empty and recipes can be added later.

        **Business Rules:**
        - User must be authenticated
        - Collection name must be unique per user
        - Default visibility is private
        - Can optionally add initial recipes during creation

        **ERD Entities:** COLLECTION
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateCollectionRequest
            example:
              name: Món Ăn Đặc Sản Miền Bắc
              description: Sưu tập các món ăn truyền thống đặc sắc của miền Bắc Việt Nam
              isPublic: false
              thumbnailUrl: https://example.com/my-collection-cover.jpg
      responses:
        "201":
          description: Collection created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/Collection
              example:
                success: true
                data:
                  id: col-987fcdeb-51d2-43a1-b234-567890123456
                  name: Món Ăn Đặc Sản Miền Bắc
                  description: Sưu tập các món ăn truyền thống đặc sắc của miền Bắc Việt Nam
                  isPublic: false
                  userId: 123e4567-e89b-12d3-a456-426614174000
                  recipesCount: 0
                  createdAt: 2024-01-15T10:30:00Z
                  updatedAt: 2024-01-15T10:30:00Z
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                duplicate_name:
                  summary: Collection name already exists
                  value:
                    success: false
                    error:
                      code: DUPLICATE_COLLECTION_NAME
                      message: You already have a collection with this name
                      details:
                        field: name
                        existingId: col-456e7890-a12b-34c5-d678-901234567890
                name_too_long:
                  summary: Name too long
                  value:
                    success: false
                    error:
                      code: VALIDATION_ERROR
                      message: Collection name cannot exceed 100 characters
                      details:
                        field: name
                        maxLength: 100
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: createCollections
  /collections/{collectionId}:
    get:
      tags:
        - Collections
      summary: Get collection details
      description: |
        Get detailed information about a collection including recipes.
        Supports both owner and public access based on visibility.

        **Business Rules:**
        - Public collections can be viewed by anyone
        - Private collections only by owner
        - Returns paginated recipe list within collection

        **ERD Entities:** COLLECTION, RECIPE (collection members)
      parameters:
        - $ref: ../components.yaml#/components/parameters/CollectionIdParam
        - name: includeRecipes
          in: query
          description: Include recipes in response
          schema:
            type: boolean
            default: true
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Collection details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/Collection
                      - type: object
                        properties:
                          recipes:
                            type: array
                            items:
                              $ref: ../components.yaml#/components/schemas/Recipe
                            description: Recipes in collection (if includeRecipes=true)
                          pagination:
                            $ref: ../components.yaml#/components/schemas/Pagination
                            description: Recipe pagination (if includeRecipes=true)
                          owner:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                              displayName:
                                type: string
                              avatarUrl:
                                type:
                                  - string
                                  - "null"
                                format: uri
                          canEdit:
                            type: boolean
                            description: Whether current user can edit this collection
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          description: Private collection access denied
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: PRIVATE_COLLECTION
                  message: This collection is private and cannot be viewed
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getCollectionsByid
    put:
      tags:
        - Collections
      summary: Update collection
      description: |
        Update collection information (name, description, visibility).
        Only collection owner can update.

        **Business Rules:**
        - Only owner can update collection
        - Name must remain unique per user
        - Can change visibility from private to public or vice versa

        **ERD Entities:** COLLECTION
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/CollectionIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type:
                    - string
                    - "null"
                  maxLength: 500
                isPublic:
                  type: boolean
                thumbnailUrl:
                  type:
                    - string
                    - "null"
                  format: uri
            example:
              name: Món Ăn Miền Bắc Đặc Sắc
              description: Phiên bản cập nhật với thêm nhiều món ngon
              isPublic: true
      responses:
        "200":
          description: Collection updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/Collection
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateCollectionsByid
    delete:
      tags:
        - Collections
      summary: Delete collection
      description: |
        Delete a collection permanently.
        Only collection owner can delete.

        **Business Rules:**
        - Only owner can delete collection
        - Requires confirmation (query parameter)
        - Hard delete - cannot be recovered
        - Does not affect recipes, only removes collection relationship

        **ERD Entities:** COLLECTION
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/CollectionIdParam
        - name: confirmDelete
          in: query
          required: true
          description: Confirmation flag (must be true)
          schema:
            type: boolean
      responses:
        "200":
          description: Collection deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: Collection deleted successfully
        "400":
          description: Missing confirmation
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: CONFIRMATION_REQUIRED
                  message: Delete confirmation required (confirmDelete=true)
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: deleteCollectionsByid
  /collections/{collectionId}/recipes:
    get:
      tags:
        - Collections
      summary: Get recipes in collection
      description: |
        Get paginated list of recipes in a specific collection.
        Supports filtering and sorting within the collection.
      parameters:
        - $ref: ../components.yaml#/components/parameters/CollectionIdParam
        - name: category
          in: query
          description: Filter by recipe category
          schema:
            type: string
            format: uuid
        - $ref: ../components.yaml#/components/parameters/DifficultyParam
        - name: sortBy
          in: query
          description: Sort recipes by
          schema:
            type: string
            enum:
              - addedAt
              - recipeName
              - recipeRating
              - cookTime
            default: addedAt
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Collection recipes retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          type: object
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Recipe
                            - type: object
                              properties:
                                addedAt:
                                  type: string
                                  format: date-time
                                  description: When recipe was added to collection
                                addedBy:
                                  type: string
                                  format: uuid
                                  description: User who added recipe to collection
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      collectionInfo:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          canEdit:
                            type: boolean
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getCollectionsByidRecipes
    post:
      tags:
        - Collections
      summary: Add recipes to collection
      description: |
        Add one or more recipes to a collection.
        Only collection owner can add recipes.

        **Business Rules:**
        - Only collection owner can add recipes
        - Recipes must be APPROVED status
        - Cannot add duplicate recipes
        - Can add multiple recipes in single request

        **ERD Entities:** COLLECTION_RECIPE (junction table)
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/CollectionIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                recipeIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
                  maxItems: 50
                  description: Recipe IDs to add
                notes:
                  type:
                    - string
                    - "null"
                  maxLength: 500
                  description: Optional notes about addition
              required:
                - recipeIds
            example:
              recipeIds:
                - 987fcdeb-51d2-43a1-b234-567890123456
                - 456e7890-a12b-34c5-d678-901234567890
              notes: Added these family favorites
      responses:
        "201":
          description: Recipes added to collection successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      addedCount:
                        type: integer
                        example: 2
                      skippedCount:
                        type: integer
                        example: 0
                        description: Recipes already in collection
                      newRecipesCount:
                        type: integer
                        example: 17
                        description: Total recipes in collection after addition
                      addedRecipes:
                        type: array
                        items:
                          type: object
                          properties:
                            recipeId:
                              type: string
                              format: uuid
                            recipeName:
                              type: string
                            addedAt:
                              type: string
                              format: date-time
                      skippedRecipes:
                        type: array
                        items:
                          type: object
                          properties:
                            recipeId:
                              type: string
                              format: uuid
                            reason:
                              type: string
                        description: Recipes that were not added and why
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                recipe_not_found:
                  summary: Some recipes not found
                  value:
                    success: false
                    error:
                      code: RECIPES_NOT_FOUND
                      message: Some recipes could not be found or are not approved
                      details:
                        notFound:
                          - 456e7890-a12b-34c5-d678-901234567890
                too_many_recipes:
                  summary: Too many recipes
                  value:
                    success: false
                    error:
                      code: TOO_MANY_RECIPES
                      message: Cannot add more than 50 recipes at once
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: createCollectionsByidRecipes
  /collections/{collectionId}/recipes/{recipeId}:
    delete:
      tags:
        - Collections
      summary: Remove recipe from collection
      description: |
        Remove a specific recipe from collection.
        Only collection owner can remove recipes.

        **Business Rules:**
        - Only collection owner can remove recipes
        - Updates collection's recipesCount
        - Updates collection's updatedAt timestamp

        **ERD Entities:** COLLECTION_RECIPE (junction table)
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/CollectionIdParam
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "200":
          description: Recipe removed from collection successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      removedRecipe:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          removedAt:
                            type: string
                            format: date-time
                      newRecipesCount:
                        type: integer
                        example: 16
                        description: Total recipes remaining in collection
              example:
                success: true
                data:
                  removedRecipe:
                    id: 987fcdeb-51d2-43a1-b234-567890123456
                    name: Thịt Kho Tàu
                    removedAt: 2024-01-15T10:30:00Z
                  newRecipesCount: 16
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          description: Recipe not in collection or collection not found
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                recipe_not_in_collection:
                  summary: Recipe not in collection
                  value:
                    success: false
                    error:
                      code: RECIPE_NOT_IN_COLLECTION
                      message: This recipe is not in the specified collection
                collection_not_found:
                  summary: Collection not found
                  value:
                    success: false
                    error:
                      code: COLLECTION_NOT_FOUND
                      message: Collection not found
      operationId: deleteCollectionsByidRecipesByid
  /meal-plans:
    get:
      tags:
        - Meal Planning
      summary: UCS06-1 - Get user's meal plans
      description: |
        Get meal plans for current user with date range filtering.
        Returns organized meal plans by date with meal entries.

        **Business Rules:**
        - Shows only meal plans owned by current user
        - Default shows current week if no date filter specified
        - Supports date range queries (single date, week, month)
        - Includes recipe information and serving calculations

        **ERD Entities:** MEAL_PLAN, MEAL_PLAN_ENTRY, RECIPE
      security:
        - bearerAuth: []
      parameters:
        - name: startDate
          in: query
          description: Start date for meal plan range (YYYY-MM-DD)
          schema:
            type: string
            format: date
          example: 2024-01-15
        - name: endDate
          in: query
          description: End date for meal plan range (YYYY-MM-DD)
          schema:
            type: string
            format: date
          example: 2024-01-21
        - name: date
          in: query
          description: Single date for meal plan (YYYY-MM-DD)
          schema:
            type: string
            format: date
          example: 2024-01-15
        - name: includeRecipes
          in: query
          description: Include full recipe information
          schema:
            type: boolean
            default: true
      responses:
        "200":
          description: Meal plans retrieved successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/MealPlanResponse
              example:
                success: true
                data:
                  mealPlans:
                    - id: mp-123e4567-e89b-12d3-a456-426614174000
                      userId: 123e4567-e89b-12d3-a456-426614174000
                      date: 2024-01-15
                      meals:
                        - mealType: BREAKFAST
                          recipeId: rec1
                          servings: 2
                          notes: Ăn sáng nhẹ nhàng
                          recipe:
                            id: rec1
                            name: Cháo gà
                        - mealType: LUNCH
                          recipeId: rec2
                          servings: 4
                          recipe:
                            id: rec2
                            name: Cơm gà Hải Nam
                      createdAt: 2024-01-14T10:00:00Z
                      updatedAt: 2024-01-14T15:30:00Z
        "400":
          description: Invalid date parameters
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: INVALID_DATE_RANGE
                  message: End date must be after start date
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getMealPlans
    post:
      tags:
        - Meal Planning
      summary: UCS06-2 - Create meal plan
      description: |
        Create a new meal plan for a specific date.
        Can create meal plan with multiple meals for different meal types.

        **Business Rules:**
        - User must be authenticated
        - Date cannot be in the past (more than 1 day ago)
        - Each meal type can only appear once per date
        - Recipes must be APPROVED status
        - Serving calculations based on recipe default servings

        **ERD Entities:** MEAL_PLAN, MEAL_PLAN_ENTRY
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateMealPlanRequest
            example:
              date: 2024-01-16
              meals:
                - mealType: BREAKFAST
                  recipeId: 987fcdeb-51d2-43a1-b234-567890123456
                  servings: 2
                  notes: Ăn sáng dinh dưỡng
                - mealType: LUNCH
                  recipeId: 456e7890-a12b-34c5-d678-901234567890
                  servings: 4
                - mealType: DINNER
                  recipeId: 789a0123-b45c-67d8-e901-234567890123
                  servings: 3
                  notes: Bữa tối gia đình
      responses:
        "201":
          description: Meal plan created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/MealPlan
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                date_in_past:
                  summary: Date in the past
                  value:
                    success: false
                    error:
                      code: INVALID_DATE
                      message: Cannot create meal plan for past dates
                      details:
                        date: 2024-01-10
                        today: 2024-01-15
                duplicate_meal_type:
                  summary: Duplicate meal type
                  value:
                    success: false
                    error:
                      code: DUPLICATE_MEAL_TYPE
                      message: Each meal type can only appear once per day
                      details:
                        duplicateType: BREAKFAST
                recipe_not_found:
                  summary: Recipe not found or not approved
                  value:
                    success: false
                    error:
                      code: RECIPE_NOT_AVAILABLE
                      message: One or more recipes are not available for meal planning
                      details:
                        unavailableRecipes:
                          - 456e7890-a12b-34c5-d678-901234567890
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "409":
          description: Meal plan already exists for date
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: MEAL_PLAN_EXISTS
                  message: Meal plan already exists for this date
                  details:
                    existingPlanId: mp-456e7890-a12b-34c5-d678-901234567890
      operationId: createMealPlans
  /meal-plans/{mealPlanId}:
    get:
      tags:
        - Meal Planning
      summary: Get meal plan details
      description: |
        Get detailed information about a specific meal plan.
        Includes full recipe information and nutritional summary.
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/MealPlanIdParam
        - name: includeNutrition
          in: query
          description: Include nutritional information summary
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Meal plan details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/MealPlan
                      - type: object
                        properties:
                          nutritionalSummary:
                            type: object
                            properties:
                              totalCalories:
                                type: number
                                format: float
                                example: 2150.5
                              totalProtein:
                                type: number
                                format: float
                                example: 95.2
                              totalCarbs:
                                type: number
                                format: float
                                example: 280.8
                              totalFat:
                                type: number
                                format: float
                                example: 78.4
                              byMealType:
                                type: object
                                additionalProperties:
                                  $ref: ../components.yaml#/components/schemas/NutritionalInfo
                            description: Nutritional summary (if includeNutrition=true)
                          canEdit:
                            type: boolean
                            description: Whether current user can edit this meal plan
                          canDelete:
                            type: boolean
                            description: Whether current user can delete this meal plan
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getMealPlansByid
    put:
      tags:
        - Meal Planning
      summary: UCS06-3 - Update meal plan
      description: |
        Update existing meal plan by adding, removing, or modifying meals.
        Only meal plan owner can update.

        **Business Rules:**
        - Only owner can update meal plan
        - Cannot update meal plans for past dates (more than 1 day ago)
        - Can add new meals or update existing ones
        - Can change servings or notes for existing meals

        **ERD Entities:** MEAL_PLAN, MEAL_PLAN_ENTRY
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/MealPlanIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                meals:
                  type: array
                  items:
                    type: object
                    properties:
                      mealType:
                        type: string
                        enum:
                          - BREAKFAST
                          - LUNCH
                          - DINNER
                          - SNACK
                      recipeId:
                        type: string
                        format: uuid
                      servings:
                        type: integer
                        minimum: 1
                      notes:
                        type:
                          - string
                          - "null"
                        maxLength: 500
                      action:
                        type: string
                        enum:
                          - ADD
                          - UPDATE
                          - REMOVE
                        default: ADD
                        description: Action to perform on this meal entry
                    required:
                      - mealType
                      - action
                notes:
                  type:
                    - string
                    - "null"
                  maxLength: 1000
                  description: Overall meal plan notes
            example:
              meals:
                - mealType: BREAKFAST
                  recipeId: new-recipe-id
                  servings: 2
                  action: UPDATE
                  notes: Thay đổi món ăn sáng
                - mealType: SNACK
                  recipeId: snack-recipe-id
                  servings: 1
                  action: ADD
                - mealType: LUNCH
                  action: REMOVE
              notes: Kế hoạch ăn uống đã điều chỉnh
      responses:
        "200":
          description: Meal plan updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/MealPlan
                      - type: object
                        properties:
                          changes:
                            type: object
                            properties:
                              added:
                                type: integer
                                example: 1
                              updated:
                                type: integer
                                example: 1
                              removed:
                                type: integer
                                example: 1
                              summary:
                                type: array
                                items:
                                  type: string
                                example:
                                  - Added SNACK meal
                                  - Updated BREAKFAST meal
                                  - Removed LUNCH meal
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateMealPlansByid
    delete:
      tags:
        - Meal Planning
      summary: UCS06-4 - Delete meal plan
      description: |
        Delete entire meal plan for a date.
        Only meal plan owner can delete.

        **Business Rules:**
        - Only owner can delete meal plan
        - Cannot delete meal plans for past dates (more than 1 day ago)
        - Requires confirmation parameter
        - Cascade deletes all meal entries

        **ERD Entities:** MEAL_PLAN, MEAL_PLAN_ENTRY
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/MealPlanIdParam
        - name: confirmDelete
          in: query
          required: true
          description: Confirmation flag (must be true)
          schema:
            type: boolean
      responses:
        "200":
          description: Meal plan deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
              example:
                success: true
                message: Meal plan deleted successfully
        "400":
          description: Missing confirmation or invalid delete
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                no_confirmation:
                  summary: Missing delete confirmation
                  value:
                    success: false
                    error:
                      code: CONFIRMATION_REQUIRED
                      message: Delete confirmation required (confirmDelete=true)
                past_date:
                  summary: Cannot delete past meal plan
                  value:
                    success: false
                    error:
                      code: CANNOT_DELETE_PAST
                      message: Cannot delete meal plans for past dates
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: deleteMealPlansByid
  /meal-plans/weekly:
    get:
      tags:
        - Meal Planning
      summary: Get weekly meal plan
      description: |
        Get meal plans organized by week for easy weekly planning view.
        Returns 7 days starting from specified date (default: current week).
      security:
        - bearerAuth: []
      parameters:
        - name: weekStartDate
          in: query
          description: Start date of week (YYYY-MM-DD), defaults to current week
          schema:
            type: string
            format: date
          example: 2024-01-15
        - name: includeNutrition
          in: query
          description: Include nutritional summary for the week
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Weekly meal plans retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      weekRange:
                        type: object
                        properties:
                          startDate:
                            type: string
                            format: date
                            example: 2024-01-15
                          endDate:
                            type: string
                            format: date
                            example: 2024-01-21
                      dailyPlans:
                        type: object
                        additionalProperties:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/MealPlan
                        description: Meal plans indexed by date (YYYY-MM-DD)
                        example:
                          2024-01-15: null
                          2024-01-16:
                            id: mp-123
                            date: 2024-01-16
                            meals: []
                      weeklyNutrition:
                        type: object
                        properties:
                          totalCalories:
                            type: number
                            format: float
                          avgDailyCalories:
                            type: number
                            format: float
                          totalProtein:
                            type: number
                            format: float
                          totalCarbs:
                            type: number
                            format: float
                          totalFat:
                            type: number
                            format: float
                        description: Weekly nutritional summary (if includeNutrition=true)
                      summary:
                        type: object
                        properties:
                          plannedDays:
                            type: integer
                            example: 5
                          totalMeals:
                            type: integer
                            example: 15
                          uniqueRecipes:
                            type: integer
                            example: 12
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: getMealPlansWeekly
    post:
      tags:
        - Meal Planning
      summary: Create weekly meal plan
      description: |
        Create meal plans for entire week with batch operation.
        More efficient than creating individual daily plans.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                weekStartDate:
                  type: string
                  format: date
                  description: Start date of week (Monday)
                dailyPlans:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      meals:
                        type: array
                        items:
                          type: object
                          properties:
                            mealType:
                              type: string
                              enum:
                                - BREAKFAST
                                - LUNCH
                                - DINNER
                                - SNACK
                            recipeId:
                              type: string
                              format: uuid
                            servings:
                              type: integer
                              minimum: 1
                            notes:
                              type:
                                - string
                                - "null"
                              maxLength: 500
                          required:
                            - mealType
                            - recipeId
                            - servings
                      notes:
                        type:
                          - string
                          - "null"
                        maxLength: 500
                  description: Plans indexed by date offset (0=Monday, 1=Tuesday, etc.)
              required:
                - weekStartDate
                - dailyPlans
            example:
              weekStartDate: 2024-01-15
              dailyPlans:
                "0":
                  meals:
                    - mealType: BREAKFAST
                      recipeId: rec1
                      servings: 2
                    - mealType: LUNCH
                      recipeId: rec2
                      servings: 4
                "1":
                  meals:
                    - mealType: BREAKFAST
                      recipeId: rec3
                      servings: 2
      responses:
        "201":
          description: Weekly meal plan created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      createdPlans:
                        type: array
                        items:
                          $ref: ../components.yaml#/components/schemas/MealPlan
                      summary:
                        type: object
                        properties:
                          totalDays:
                            type: integer
                            example: 7
                          plannedDays:
                            type: integer
                            example: 5
                          totalMeals:
                            type: integer
                            example: 15
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: createMealPlansWeekly
  /meal-plans/{mealPlanId}/shopping-list:
    get:
      tags:
        - Meal Planning
      summary: UCS06-5 - Generate shopping list from meal plan
      description: |
        Generate shopping list from meal plan by aggregating ingredients.
        Combines ingredients from all recipes in the meal plan with serving adjustments.

        **Business Rules:**
        - Aggregates ingredients from all recipes in meal plan
        - Adjusts quantities based on planned servings vs recipe default servings
        - Groups ingredients by category for organized shopping
        - Combines same ingredients with different units when possible

        **ERD Entities:** MEAL_PLAN, MEAL_PLAN_ENTRY, RECIPE, INGREDIENT
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/MealPlanIdParam
        - name: groupBy
          in: query
          description: Group ingredients by category or recipe
          schema:
            type: string
            enum:
              - category
              - recipe
              - none
            default: category
        - name: includeOptional
          in: query
          description: Include optional ingredients (from recipe notes)
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Shopping list generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      mealPlan:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          date:
                            type: string
                            format: date
                          totalMeals:
                            type: integer
                      shoppingList:
                        type: object
                        properties:
                          generatedAt:
                            type: string
                            format: date-time
                          totalItems:
                            type: integer
                            example: 24
                          estimatedCost:
                            type:
                              - number
                              - "null"
                            format: float
                            description: Estimated cost (if available)
                          ingredients:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                  example: Thịt heo ba chỉ
                                totalAmount:
                                  type: number
                                  format: float
                                  example: 750
                                unit:
                                  type: string
                                  example: gram
                                category:
                                  type: string
                                  example: Thịt
                                notes:
                                  type:
                                    - string
                                    - "null"
                                  example: Chọn miếng có vân mỡ đều
                                fromRecipes:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      recipeId:
                                        type: string
                                        format: uuid
                                      recipeName:
                                        type: string
                                      mealType:
                                        type: string
                                      amount:
                                        type: number
                                        format: float
                                      servings:
                                        type: integer
                                  description: Which recipes contribute to this ingredient
                                isOptional:
                                  type: boolean
                                  default: false
                                priority:
                                  type: string
                                  enum:
                                    - HIGH
                                    - MEDIUM
                                    - LOW
                                  default: MEDIUM
                          groupedIngredients:
                            type: object
                            additionalProperties:
                              type: array
                              items:
                                type: object
                            description: Ingredients grouped by category/recipe (if groupBy != none)
                            example:
                              Thịt: []
                              Rau củ: []
                              Gia vị: []
              example:
                success: true
                data:
                  shoppingList:
                    generatedAt: 2024-01-15T10:30:00Z
                    totalItems: 24
                    ingredients:
                      - name: Thịt heo ba chỉ
                        totalAmount: 750
                        unit: gram
                        category: Thịt
                        fromRecipes:
                          - recipeId: rec1
                            recipeName: Thịt kho tàu
                            mealType: LUNCH
                            amount: 500
                            servings: 4
                          - recipeId: rec2
                            recipeName: Bún thịt nướng
                            mealType: DINNER
                            amount: 250
                            servings: 2
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getMealPlansByidShoppingList
    post:
      tags:
        - Meal Planning
      summary: Generate shopping list from date range
      description: |
        Generate shopping list from multiple meal plans within a date range.
        Useful for weekly or monthly grocery shopping.
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/MealPlanIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dateRange:
                  type: object
                  properties:
                    startDate:
                      type: string
                      format: date
                    endDate:
                      type: string
                      format: date
                  required:
                    - startDate
                    - endDate
                options:
                  type: object
                  properties:
                    groupBy:
                      type: string
                      enum:
                        - category
                        - recipe
                        - date
                        - none
                      default: category
                    includeOptional:
                      type: boolean
                      default: false
                    combineUnits:
                      type: boolean
                      default: true
                      description: Attempt to combine same ingredients with different units
                    excludeIngredients:
                      type: array
                      items:
                        type: string
                      description: Ingredients to exclude (already have at home)
              required:
                - dateRange
      responses:
        "200":
          description: Multi-day shopping list generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      dateRange:
                        type: object
                        properties:
                          startDate:
                            type: string
                            format: date
                          endDate:
                            type: string
                            format: date
                          totalDays:
                            type: integer
                          plannedDays:
                            type: integer
                      consolidatedList:
                        type: object
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: createMealPlansByidShoppingList
  /meal-plans/suggest:
    post:
      tags:
        - Meal Planning
      summary: Get meal plan suggestions
      description: |
        Get AI-powered meal plan suggestions based on preferences and constraints.
        Helps users create balanced meal plans automatically.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dateRange:
                  type: object
                  properties:
                    startDate:
                      type: string
                      format: date
                    days:
                      type: integer
                      minimum: 1
                      maximum: 30
                      default: 7
                  required:
                    - startDate
                preferences:
                  type: object
                  properties:
                    dietaryRestrictions:
                      type: array
                      items:
                        type: string
                      example:
                        - vegetarian
                        - gluten-free
                    favoriteCategories:
                      type: array
                      items:
                        type: string
                        format: uuid
                    maxCookTimePerMeal:
                      type: integer
                      minimum: 15
                      example: 60
                    budgetPerDay:
                      type:
                        - number
                        - "null"
                      format: float
                      example: 200000
                    servings:
                      type: integer
                      minimum: 1
                      default: 2
                      example: 4
                constraints:
                  type: object
                  properties:
                    excludeRecipes:
                      type: array
                      items:
                        type: string
                        format: uuid
                      description: Recipes to avoid
                    requiredMealTypes:
                      type: array
                      items:
                        type: string
                        enum:
                          - BREAKFAST
                          - LUNCH
                          - DINNER
                          - SNACK
                      default:
                        - BREAKFAST
                        - LUNCH
                        - DINNER
                    maxRepeatRecipes:
                      type: integer
                      minimum: 0
                      default: 1
                      description: How many times same recipe can appear in plan
              required:
                - dateRange
            example:
              dateRange:
                startDate: 2024-01-16
                days: 7
              preferences:
                dietaryRestrictions:
                  - halal
                maxCookTimePerMeal: 60
                servings: 4
              constraints:
                requiredMealTypes:
                  - BREAKFAST
                  - LUNCH
                  - DINNER
                maxRepeatRecipes: 1
      responses:
        "200":
          description: Meal plan suggestions generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      suggestions:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                              format: date
                            meals:
                              type: array
                              items:
                                type: object
                                properties:
                                  mealType:
                                    type: string
                                    enum:
                                      - BREAKFAST
                                      - LUNCH
                                      - DINNER
                                      - SNACK
                                  recipe:
                                    $ref: ../components.yaml#/components/schemas/Recipe
                                  suggestedServings:
                                    type: integer
                                  matchScore:
                                    type: number
                                    format: float
                                    description: How well recipe matches preferences (0-1)
                                  reason:
                                    type: string
                                    description: Why this recipe was suggested
                                    example: High protein, matches dietary restrictions
                      summary:
                        type: object
                        properties:
                          totalMeals:
                            type: integer
                          uniqueRecipes:
                            type: integer
                          estimatedCost:
                            type:
                              - number
                              - "null"
                            format: float
                          nutritionalBalance:
                            type: object
                            properties:
                              score:
                                type: number
                                format: float
                                minimum: 0
                                maximum: 1
                              notes:
                                type: array
                                items:
                                  type: string
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
      operationId: createMealPlansSuggest
  /admin/users:
    get:
      tags:
        - Admin - Users
      summary: UCA01-1 - View users list
      description: |
        Get paginated list of all users with filtering, search, and sorting capabilities.
        Admin-only endpoint for user oversight and management.

        **Business Rules:**
        - Requires admin authentication and user management permissions
        - Supports advanced filtering by status, role, registration date
        - Full-text search on email, name fields
        - Includes user statistics and activity summaries
        - Returns audit trail for sensitive operations

        **ERD Entities:** USER, USER_ACTIVITY (for stats)
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/StatusParam
        - name: role
          in: query
          description: Filter by user role
          schema:
            type: string
            enum:
              - user
              - admin
              - moderator
        - name: search
          in: query
          description: Search in email and display name
          schema:
            type: string
            minLength: 2
            maxLength: 100
          example: nguyen
        - name: registrationDateFrom
          in: query
          description: Filter users registered after date
          schema:
            type: string
            format: date
        - name: registrationDateTo
          in: query
          description: Filter users registered before date
          schema:
            type: string
            format: date
        - name: lastLoginFrom
          in: query
          description: Filter by last login date (activity analysis)
          schema:
            type: string
            format: date
        - name: sortBy
          in: query
          description: Sort users by field
          schema:
            type: string
            enum:
              - createdAt
              - lastLoginAt
              - email
              - displayName
              - status
            default: createdAt
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Users list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/User
                            - type: object
                              properties:
                                stats:
                                  type: object
                                  properties:
                                    recipesCount:
                                      type: integer
                                    favoritesCount:
                                      type: integer
                                    ratingsCount:
                                      type: integer
                                    commentsCount:
                                      type: integer
                                    totalLogins:
                                      type: integer
                                    accountAge:
                                      type: integer
                                      description: Account age in days
                                recentActivity:
                                  type: object
                                  properties:
                                    lastRecipeCreated:
                                      type:
                                        - string
                                        - "null"
                                      format: date-time
                                    lastComment:
                                      type:
                                        - string
                                        - "null"
                                      format: date-time
                                    activityScore:
                                      type: number
                                      format: float
                                      description: Activity score (0-1)
                                riskFlags:
                                  type: array
                                  items:
                                    type: string
                                  description: Potential risk indicators
                                  example:
                                    - multiple_failed_logins
                                    - spam_reports
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      summary:
                        type: object
                        properties:
                          totalUsers:
                            type: integer
                            example: 15420
                          statusBreakdown:
                            type: object
                            properties:
                              VERIFIED:
                                type: integer
                                example: 14580
                              PENDING:
                                type: integer
                                example: 650
                              LOCKED:
                                type: integer
                                example: 190
                          newUsersThisMonth:
                            type: integer
                            example: 1250
                          activeUsersLastWeek:
                            type: integer
                            example: 8960
              example:
                success: true
                data:
                  users:
                    - id: 123e4567-e89b-12d3-a456-426614174000
                      email: nguyen.van.a@example.com
                      displayName: Nguyễn Văn A
                      status: VERIFIED
                      createdAt: 2024-01-15T10:30:00Z
                      lastLoginAt: 2024-01-24T08:15:00Z
                      stats:
                        recipesCount: 25
                        favoritesCount: 150
                        accountAge: 180
                      riskFlags: []
                  pagination:
                    page: 1
                    limit: 20
                    total: 15420
                    totalPages: 771
                    hasNext: true
                    hasPrevious: false
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          description: Insufficient admin permissions
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              example:
                success: false
                error:
                  code: INSUFFICIENT_PERMISSIONS
                  message: Admin permissions required for user management
      operationId: getAdminUsers
  /admin/users/{userId}:
    get:
      tags:
        - Admin - Users
      summary: UCA01-2 - View user details
      description: |
        Get comprehensive user details including profile, activity history, and statistics.
        Provides complete user overview for admin decision making.

        **Business Rules:**
        - Requires admin authentication with user read permissions
        - Returns complete user profile with sensitive information
        - Includes detailed activity history and login patterns
        - Shows user-generated content statistics
        - Provides audit trail and violation history

        **ERD Entities:** USER, USER_ACTIVITY, AUDIT_LOG, USER_SESSION
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/UserIdParam
        - name: includeActivity
          in: query
          description: Include recent activity history
          schema:
            type: boolean
            default: true
        - name: includeAuditLogs
          in: query
          description: Include admin audit logs for this user
          schema:
            type: boolean
            default: true
        - name: activityLimit
          in: query
          description: Limit number of recent activities
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        "200":
          description: User details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/UserProfile
                      - type: object
                        properties:
                          adminInfo:
                            type: object
                            properties:
                              registrationIP:
                                type: string
                                description: IP address used during registration
                                example: 192.168.1.100
                              emailVerified:
                                type: boolean
                                example: true
                              phoneVerified:
                                type: boolean
                                example: false
                              twoFactorEnabled:
                                type: boolean
                                example: false
                              lockInfo:
                                type: object
                                properties:
                                  isLocked:
                                    type: boolean
                                  reason:
                                    type:
                                      - string
                                      - "null"
                                  lockUntil:
                                    type:
                                      - string
                                      - "null"
                                    format: date-time
                                  lockedBy:
                                    type:
                                      - string
                                      - "null"
                                    format: uuid
                                    description: Admin who locked the account
                                  lockedAt:
                                    type:
                                      - string
                                      - "null"
                                    format: date-time
                          detailedStats:
                            type: object
                            properties:
                              content:
                                type: object
                                properties:
                                  totalRecipes:
                                    type: integer
                                  approvedRecipes:
                                    type: integer
                                  pendingRecipes:
                                    type: integer
                                  rejectedRecipes:
                                    type: integer
                                  totalComments:
                                    type: integer
                                  totalRatings:
                                    type: integer
                                  avgRatingGiven:
                                    type: number
                                    format: float
                              engagement:
                                type: object
                                properties:
                                  totalLogins:
                                    type: integer
                                  avgSessionDuration:
                                    type: number
                                    format: float
                                    description: Average session duration in minutes
                                  lastActiveDate:
                                    type: string
                                    format: date-time
                                  longestStreak:
                                    type: integer
                                    description: Longest consecutive login days
                                  currentStreak:
                                    type: integer
                              social:
                                type: object
                                properties:
                                  totalFavorites:
                                    type: integer
                                  recipesShared:
                                    type: integer
                                  helpfulVotesReceived:
                                    type: integer
                                  helpfulVotesGiven:
                                    type: integer
                          recentActivity:
                            type: array
                            items:
                              $ref: ../components.yaml#/components/schemas/UserActivity
                            description: Recent user activities (if includeActivity=true)
                          loginHistory:
                            type: array
                            items:
                              type: object
                              properties:
                                timestamp:
                                  type: string
                                  format: date-time
                                ipAddress:
                                  type: string
                                userAgent:
                                  type: string
                                sessionDuration:
                                  type: integer
                                  description: Session duration in minutes
                                location:
                                  type:
                                    - string
                                    - "null"
                                  description: Approximate location based on IP
                            maxItems: 20
                            description: Recent login history
                          auditLogs:
                            type: array
                            items:
                              $ref: ../components.yaml#/components/schemas/AuditLog
                            description: Admin actions related to this user (if includeAuditLogs=true)
                          riskAssessment:
                            type: object
                            properties:
                              riskScore:
                                type: number
                                format: float
                                minimum: 0
                                maximum: 1
                                description: Computed risk score
                              flags:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    type:
                                      type: string
                                      enum:
                                        - SUSPICIOUS_LOGIN
                                        - CONTENT_VIOLATION
                                        - SPAM_BEHAVIOR
                                        - MULTIPLE_REPORTS
                                    severity:
                                      type: string
                                      enum:
                                        - LOW
                                        - MEDIUM
                                        - HIGH
                                        - CRITICAL
                                    description:
                                      type: string
                                    detectedAt:
                                      type: string
                                      format: date-time
                              recommendations:
                                type: array
                                items:
                                  type: string
                                description: Recommended admin actions
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getAdminUsersByid
  /admin/users/{userId}/deactivate:
    put:
      tags:
        - Admin - Users
      summary: UCA01-3 - Deactivate user account
      description: |
        Deactivate/lock user account with reason and duration.
        Sets user status to LOCKED and revokes active sessions.

        **Business Rules:**
        - Requires admin authentication with user management permissions
        - Must provide reason for account lock (audit requirement)
        - Optional duration - null means permanent lock
        - Automatically revokes all active user sessions
        - Creates audit log entry for compliance
        - Sends notification to user (if not system suspension)

        **ERD Entities:** USER, USER_SESSION, AUDIT_LOG
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/UserIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/DeactivateUserRequest
            example:
              reason: Multiple violations of community guidelines - inappropriate content and spam behavior
              duration: 30
              notifyUser: true
              revokeTokens: true
      responses:
        "200":
          description: User account deactivated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                          displayName:
                            type: string
                          status:
                            type: string
                            example: LOCKED
                          lockInfo:
                            type: object
                            properties:
                              reason:
                                type: string
                              lockUntil:
                                type:
                                  - string
                                  - "null"
                                format: date-time
                              lockedBy:
                                type: string
                                format: uuid
                              lockedAt:
                                type: string
                                format: date-time
                      auditLog:
                        $ref: ../components.yaml#/components/schemas/AuditLog
                      sessionsRevoked:
                        type: integer
                        description: Number of active sessions revoked
                        example: 3
                      notificationSent:
                        type: boolean
                        description: Whether user notification was sent
                        example: true
        "400":
          description: Invalid deactivation request
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                already_locked:
                  summary: User already locked
                  value:
                    success: false
                    error:
                      code: USER_ALREADY_LOCKED
                      message: User account is already locked
                      details:
                        currentStatus: LOCKED
                        lockUntil: 2024-02-15T10:30:00Z
                invalid_duration:
                  summary: Invalid lock duration
                  value:
                    success: false
                    error:
                      code: INVALID_DURATION
                      message: Lock duration must be between 1 and 365 days
                      details:
                        provided: 400
                        max: 365
                reason_too_short:
                  summary: Reason too short
                  value:
                    success: false
                    error:
                      code: REASON_TOO_SHORT
                      message: Reason must be at least 10 characters
                      details:
                        minLength: 10
                        provided: 8
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateAdminUsersByidDeactivate
  /admin/users/{userId}/activate:
    put:
      tags:
        - Admin - Users
      summary: UCA01-4 - Activate user account
      description: |
        Reactivate previously locked user account.
        Removes lock status and allows user to login again.

        **Business Rules:**
        - Requires admin authentication with user management permissions
        - Can only activate LOCKED accounts
        - Must provide reason for reactivation (audit requirement)
        - Creates audit log entry for compliance
        - Optionally sends welcome back notification

        **ERD Entities:** USER, AUDIT_LOG
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/UserIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  minLength: 10
                  maxLength: 500
                  description: Reason for account reactivation
                notifyUser:
                  type: boolean
                  default: true
                  description: Send reactivation notification to user
                resetPasswordRequired:
                  type: boolean
                  default: false
                  description: Require password reset on next login
              required:
                - reason
            example:
              reason: User appeal accepted - violation was accidental, user has been educated on community
                guidelines
              notifyUser: true
              resetPasswordRequired: false
      responses:
        "200":
          description: User account activated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                          displayName:
                            type: string
                          status:
                            type: string
                            example: VERIFIED
                          activatedAt:
                            type: string
                            format: date-time
                          previousLockInfo:
                            type: object
                            properties:
                              reason:
                                type: string
                              duration:
                                type:
                                  - integer
                                  - "null"
                              lockedBy:
                                type: string
                                format: uuid
                              lockedAt:
                                type: string
                                format: date-time
                      auditLog:
                        $ref: ../components.yaml#/components/schemas/AuditLog
                      notificationSent:
                        type: boolean
                        example: true
        "400":
          description: Invalid activation request
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                not_locked:
                  summary: User not locked
                  value:
                    success: false
                    error:
                      code: USER_NOT_LOCKED
                      message: User account is not locked
                      details:
                        currentStatus: VERIFIED
                auto_unlock_pending:
                  summary: Auto unlock scheduled
                  value:
                    success: false
                    error:
                      code: AUTO_UNLOCK_PENDING
                      message: Account has scheduled automatic unlock
                      details:
                        unlockDate: 2024-02-15T10:30:00Z
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateAdminUsersByidActivate
  /admin/users/{userId}/activities:
    get:
      tags:
        - Admin - Users
      summary: Get user activity history
      description: |
        Get detailed activity history for specific user.
        Provides timeline of user actions for analysis and support.

        **ERD Entities:** USER_ACTIVITY, AUDIT_LOG
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/UserIdParam
        - name: activityType
          in: query
          description: Filter by activity type
          schema:
            type: string
            enum:
              - RECIPE_CREATE
              - RECIPE_UPDATE
              - COMMENT_POST
              - RATING_GIVE
              - LOGIN
              - LOGOUT
              - PROFILE_UPDATE
        - name: dateFrom
          in: query
          description: Activities after date
          schema:
            type: string
            format: date-time
        - name: dateTo
          in: query
          description: Activities before date
          schema:
            type: string
            format: date-time
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: User activities retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      activities:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/UserActivity
                            - type: object
                              properties:
                                details:
                                  type: object
                                  description: Activity-specific details
                                ipAddress:
                                  type:
                                    - string
                                    - "null"
                                userAgent:
                                  type:
                                    - string
                                    - "null"
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      summary:
                        type: object
                        properties:
                          totalActivities:
                            type: integer
                          activityTypeBreakdown:
                            type: object
                            additionalProperties:
                              type: integer
                          timelineSpan:
                            type: object
                            properties:
                              firstActivity:
                                type: string
                                format: date-time
                              lastActivity:
                                type: string
                                format: date-time
                              activeDays:
                                type: integer
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getAdminUsersByidActivities
  /admin/recipes:
    get:
      tags:
        - Admin - Recipes
      summary: UCA02-1 - View all recipes (system and user)
      description: |
        Get comprehensive list of all recipes in the system for admin oversight.
        Includes system recipes, user submissions, and approval status.

        **Business Rules:**
        - Shows ALL recipes regardless of status (DRAFT, PENDING, APPROVED, REJECTED)
        - Includes detailed approval information and admin actions
        - Supports filtering by status, creator type, category
        - Shows flagged or reported recipes for moderation

        **ERD Entities:** RECIPE, USER, CATEGORY, AUDIT_LOG
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeStatusParam
        - name: creatorType
          in: query
          description: Filter by creator type
          schema:
            type: string
            enum:
              - system
              - user
              - admin
        - name: createdBy
          in: query
          description: Filter by specific creator ID
          schema:
            type: string
            format: uuid
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
            format: uuid
        - name: flagged
          in: query
          description: Show only flagged/reported recipes
          schema:
            type: boolean
        - name: sortBy
          in: query
          description: Sort recipes by
          schema:
            type: string
            enum:
              - createdAt
              - updatedAt
              - name
              - status
              - views
              - reports
            default: updatedAt
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Recipes list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Recipe
                            - type: object
                              properties:
                                adminInfo:
                                  type: object
                                  properties:
                                    creatorType:
                                      type: string
                                      enum:
                                        - system
                                        - user
                                        - admin
                                    approvalInfo:
                                      type: object
                                      properties:
                                        approvedBy:
                                          type:
                                            - string
                                            - "null"
                                          format: uuid
                                        approvedAt:
                                          type:
                                            - string
                                            - "null"
                                          format: date-time
                                        rejectedBy:
                                          type:
                                            - string
                                            - "null"
                                          format: uuid
                                        rejectedAt:
                                          type:
                                            - string
                                            - "null"
                                          format: date-time
                                        rejectionReason:
                                          type:
                                            - string
                                            - "null"
                                    reportCount:
                                      type: integer
                                      description: Number of user reports
                                    flags:
                                      type: array
                                      items:
                                        type: string
                                      description: Admin flags for this recipe
                                    lastReviewed:
                                      type:
                                        - string
                                        - "null"
                                      format: date-time
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      summary:
                        type: object
                        properties:
                          totalRecipes:
                            type: integer
                          statusBreakdown:
                            type: object
                            properties:
                              APPROVED:
                                type: integer
                              PENDING:
                                type: integer
                              REJECTED:
                                type: integer
                              DRAFT:
                                type: integer
                          pendingReviewCount:
                            type: integer
                          flaggedRecipesCount:
                            type: integer
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
      operationId: getAdminRecipes
    post:
      tags:
        - Admin - Recipes
      summary: UCA02-2 - Create system recipe
      description: |
        Create official system recipe with automatic approval.
        System recipes bypass normal approval process.

        **Business Rules:**
        - Requires admin authentication with recipe management permissions
        - System recipes are automatically APPROVED status
        - Created by system/admin, not regular users
        - Can include official nutritional information and dietary tags

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: ../components.yaml#/components/schemas/CreateRecipeRequest
                - type: object
                  properties:
                    isOfficial:
                      type: boolean
                      default: true
                      description: Mark as official system recipe
                    officialNutrition:
                      $ref: ../components.yaml#/components/schemas/NutritionalInfo
                      description: Official nutritional information
                    certifications:
                      type: array
                      items:
                        type: string
                      description: Official certifications (halal, organic, etc.)
                    adminNotes:
                      type: string
                      maxLength: 1000
                      description: Internal admin notes
            example:
              name: Phở Bò Hà Nội Truyền Thống
              description: Công thức phở bò chính thống theo truyền thống Hà Nội
              categoryId: 123e4567-e89b-12d3-a456-426614174001
              difficulty: HARD
              servings: 4
              prepTime: 180
              cookTime: 240
              isOfficial: true
              certifications:
                - traditional
                - authentic
      responses:
        "201":
          description: System recipe created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/RecipeDetail
                      - type: object
                        properties:
                          systemRecipe:
                            type: boolean
                            example: true
                          autoApproved:
                            type: boolean
                            example: true
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
      operationId: createAdminRecipes
  /admin/recipes/system:
    get:
      tags:
        - Admin - Recipes
      summary: Get system recipes only
      description: |
        Get list of official system recipes for management.

        **ERD Entities:** RECIPE (where created_by is system/admin)
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by category
          schema:
            type: string
            format: uuid
        - $ref: ../components.yaml#/components/parameters/DifficultyParam
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: System recipes retrieved
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/RecipeListResponse
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
      operationId: getAdminRecipesSystem
  /admin/recipes/pending:
    get:
      tags:
        - Admin - Recipes
      summary: UCA02-5 - Get pending recipes
      description: |
        Get list of user-submitted recipes awaiting approval.
        Prioritized by submission date and user history.

        **Business Rules:**
        - Shows only PENDING status recipes from users
        - Includes user reputation and submission history
        - Supports priority sorting for review efficiency
        - Shows estimated review time based on complexity

        **ERD Entities:** RECIPE, USER
      security:
        - bearerAuth: []
      parameters:
        - name: priority
          in: query
          description: Filter by review priority
          schema:
            type: string
            enum:
              - high
              - medium
              - low
        - name: submittedAfter
          in: query
          description: Submitted after date
          schema:
            type: string
            format: date
        - name: sortBy
          in: query
          description: Sort by priority factors
          schema:
            type: string
            enum:
              - submittedAt
              - priority
              - userReputation
              - complexity
            default: submittedAt
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Pending recipes retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipes:
                        type: array
                        items:
                          allOf:
                            - $ref: ../components.yaml#/components/schemas/Recipe
                            - type: object
                              properties:
                                submissionInfo:
                                  type: object
                                  properties:
                                    submittedAt:
                                      type: string
                                      format: date-time
                                    waitingTime:
                                      type: integer
                                      description: Days waiting for review
                                    priority:
                                      type: string
                                      enum:
                                        - high
                                        - medium
                                        - low
                                    estimatedReviewTime:
                                      type: integer
                                      description: Estimated review minutes
                                userInfo:
                                  type: object
                                  properties:
                                    id:
                                      type: string
                                      format: uuid
                                    displayName:
                                      type: string
                                    reputation:
                                      type: number
                                      format: float
                                      description: User reputation score
                                    approvedRecipes:
                                      type: integer
                                    rejectedRecipes:
                                      type: integer
                                    isNewUser:
                                      type: boolean
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
                      summary:
                        type: object
                        properties:
                          totalPending:
                            type: integer
                          avgWaitTime:
                            type: number
                            format: float
                          priorityBreakdown:
                            type: object
                            properties:
                              high:
                                type: integer
                              medium:
                                type: integer
                              low:
                                type: integer
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
      operationId: getAdminRecipesPending
  /admin/recipes/{recipeId}:
    get:
      tags:
        - Admin - Recipes
      summary: Get recipe details for admin review
      description: |
        Get comprehensive recipe details for admin review and decision making.

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, USER, RATING, COMMENT
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      responses:
        "200":
          description: Recipe details for admin review
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/RecipeDetail
                      - type: object
                        properties:
                          adminReview:
                            type: object
                            properties:
                              canApprove:
                                type: boolean
                              canReject:
                                type: boolean
                              canEdit:
                                type: boolean
                              qualityChecks:
                                type: object
                                properties:
                                  hasImages:
                                    type: boolean
                                  ingredientsComplete:
                                    type: boolean
                                  stepsDetailed:
                                    type: boolean
                                  grammarCheck:
                                    type: string
                                    enum:
                                      - pass
                                      - warning
                                      - fail
                                  duplicateCheck:
                                    type: object
                                    properties:
                                      isDuplicate:
                                        type: boolean
                                      similarRecipes:
                                        type: array
                                        items:
                                          type: object
                                          properties:
                                            id:
                                              type: string
                                              format: uuid
                                            name:
                                              type: string
                                            similarity:
                                              type: number
                                              format: float
                              reviewHistory:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    action:
                                      type: string
                                      enum:
                                        - SUBMITTED
                                        - REVIEWED
                                        - APPROVED
                                        - REJECTED
                                        - FLAGGED
                                    adminId:
                                      type:
                                        - string
                                        - "null"
                                      format: uuid
                                    timestamp:
                                      type: string
                                      format: date-time
                                    notes:
                                      type:
                                        - string
                                        - "null"
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: getAdminRecipesByid
    put:
      tags:
        - Admin - Recipes
      summary: UCA02-3 - Update recipe (admin)
      description: |
        Admin update/edit any recipe in the system.
        Can modify system recipes or user recipes.

        **ERD Entities:** RECIPE, INGREDIENT, RECIPE_STEP, RECIPE_MEDIA
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: ../components.yaml#/components/schemas/CreateRecipeRequest
                - type: object
                  properties:
                    adminNotes:
                      type: string
                      maxLength: 1000
                      description: Admin notes for this edit
                    notifyAuthor:
                      type: boolean
                      default: true
                      description: Notify original author of changes
      responses:
        "200":
          description: Recipe updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: ../components.yaml#/components/schemas/RecipeDetail
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateAdminRecipesByid
    delete:
      tags:
        - Admin - Recipes
      summary: UCA02-4 - Delete recipe (admin)
      description: |
        Admin delete any recipe from the system.
        Uses soft delete to preserve references and audit trail.

        **ERD Entities:** RECIPE
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
        - name: reason
          in: query
          required: true
          description: Reason for deletion
          schema:
            type: string
            minLength: 10
            maxLength: 500
        - name: notifyAuthor
          in: query
          description: Notify original author
          schema:
            type: boolean
            default: true
      responses:
        "200":
          description: Recipe deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
        "400":
          $ref: ../components.yaml#/components/responses/BadRequest
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: deleteAdminRecipesByid
  /admin/recipes/{recipeId}/approve:
    put:
      tags:
        - Admin - Recipes
      summary: UCA02-6 - Approve recipe
      description: |
        Approve user-submitted recipe for public visibility.
        Changes status to APPROVED and makes recipe searchable.

        **Business Rules:**
        - Only PENDING recipes can be approved
        - Approved recipes become publicly visible and searchable
        - Creates audit log entry for approval decision
        - Sends notification to recipe author
        - Updates recipe approval statistics

        **ERD Entities:** RECIPE, AUDIT_LOG
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                approvalNotes:
                  type: string
                  maxLength: 500
                  description: Optional approval notes
                featuredRecipe:
                  type: boolean
                  default: false
                  description: Mark as featured recipe
                qualityRating:
                  type: string
                  enum:
                    - excellent
                    - good
                    - acceptable
                  default: acceptable
                  description: Quality assessment
                notifyAuthor:
                  type: boolean
                  default: true
            example:
              approvalNotes: Excellent recipe with clear instructions and good photos
              featuredRecipe: false
              qualityRating: excellent
      responses:
        "200":
          description: Recipe approved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipe:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          status:
                            type: string
                            example: APPROVED
                          approvedAt:
                            type: string
                            format: date-time
                          approvedBy:
                            type: string
                            format: uuid
                      auditLog:
                        $ref: ../components.yaml#/components/schemas/AuditLog
                      notificationSent:
                        type: boolean
        "400":
          description: Cannot approve recipe
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                not_pending:
                  summary: Recipe not pending
                  value:
                    success: false
                    error:
                      code: NOT_PENDING_APPROVAL
                      message: Only pending recipes can be approved
                      details:
                        currentStatus: APPROVED
                quality_issues:
                  summary: Quality issues found
                  value:
                    success: false
                    error:
                      code: QUALITY_ISSUES
                      message: Recipe has quality issues that must be addressed
                      details:
                        issues:
                          - missing_images
                          - incomplete_steps
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateAdminRecipesByidApprove
  /admin/recipes/{recipeId}/reject:
    put:
      tags:
        - Admin - Recipes
      summary: UCA02-7 - Reject recipe
      description: |
        Reject user-submitted recipe with detailed feedback.
        Changes status to REJECTED and provides improvement guidance.

        **Business Rules:**
        - Only PENDING recipes can be rejected
        - Must provide detailed rejection reason for user learning
        - Creates audit log entry for rejection decision
        - Sends constructive feedback to recipe author
        - Author can resubmit after addressing issues

        **ERD Entities:** RECIPE, AUDIT_LOG
      security:
        - bearerAuth: []
      parameters:
        - $ref: ../components.yaml#/components/parameters/RecipeIdParam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rejectionReason:
                  type: string
                  minLength: 20
                  maxLength: 1000
                  description: Detailed reason for rejection
                issues:
                  type: array
                  items:
                    type: string
                    enum:
                      - UNCLEAR_INSTRUCTIONS
                      - MISSING_INGREDIENTS
                      - POOR_IMAGES
                      - DUPLICATE_CONTENT
                      - INAPPROPRIATE_CONTENT
                      - SAFETY_CONCERNS
                  minItems: 1
                  description: Specific issues identified
                suggestions:
                  type: string
                  maxLength: 1000
                  description: Constructive suggestions for improvement
                allowResubmission:
                  type: boolean
                  default: true
                  description: Allow author to resubmit after fixes
                notifyAuthor:
                  type: boolean
                  default: true
              required:
                - rejectionReason
                - issues
            example:
              rejectionReason: Recipe instructions are unclear and missing several key preparation steps. Images
                are blurry and don't clearly show the cooking process.
              issues:
                - UNCLEAR_INSTRUCTIONS
                - POOR_IMAGES
              suggestions: Please provide step-by-step photos and more detailed cooking instructions, especially
                for the sauce preparation.
              allowResubmission: true
      responses:
        "200":
          description: Recipe rejected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipe:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          status:
                            type: string
                            example: REJECTED
                          rejectedAt:
                            type: string
                            format: date-time
                          rejectedBy:
                            type: string
                            format: uuid
                          rejectionInfo:
                            type: object
                            properties:
                              reason:
                                type: string
                              issues:
                                type: array
                                items:
                                  type: string
                              suggestions:
                                type: string
                              canResubmit:
                                type: boolean
                      auditLog:
                        $ref: ../components.yaml#/components/schemas/AuditLog
                      feedbackSent:
                        type: boolean
        "400":
          description: Cannot reject recipe
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/ErrorResponse
              examples:
                not_pending:
                  summary: Recipe not pending
                  value:
                    success: false
                    error:
                      code: NOT_PENDING_APPROVAL
                      message: Only pending recipes can be rejected
                insufficient_reason:
                  summary: Rejection reason too short
                  value:
                    success: false
                    error:
                      code: INSUFFICIENT_FEEDBACK
                      message: Rejection reason must be at least 20 characters for constructive feedback
        "401":
          $ref: ../components.yaml#/components/responses/Unauthorized
        "403":
          $ref: ../components.yaml#/components/responses/Forbidden
        "404":
          $ref: ../components.yaml#/components/responses/NotFound
      operationId: updateAdminRecipesByidReject
  /admin/categories:
    get:
      tags:
        - Admin - Categories
      summary: UCA03-1 - View categories list
      description: |
        Get hierarchical list of all recipe categories for admin management.
        Includes usage statistics and category relationships.

        **ERD Entities:** CATEGORY
      security:
        - bearerAuth: []
      parameters:
        - name: includeEmpty
          in: query
          description: Include categories with no recipes
          schema:
            type: boolean
            default: true
        - name: level
          in: query
          description: Category hierarchy level
          schema:
            type: integer
            minimum: 0
      responses:
        "200":
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/CategoryListResponse
      operationId: getAdminCategories
    post:
      tags:
        - Admin - Categories
      summary: UCA03-2 - Create new category
      description: |
        Create new recipe category with hierarchical support.

        **ERD Entities:** CATEGORY
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateCategoryRequest
      responses:
        "201":
          description: Category created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/Category
      operationId: createAdminCategories
  /admin/categories/{categoryId}:
    get:
      tags:
        - Admin - Categories
      summary: Get category details
      description: Get detailed category information with usage statistics
      security:
        - bearerAuth: []
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Category details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    allOf:
                      - $ref: ../components.yaml#/components/schemas/Category
                      - type: object
                        properties:
                          statistics:
                            type: object
                            properties:
                              activeRecipes:
                                type: integer
                              totalRecipes:
                                type: integer
                              subcategoriesCount:
                                type: integer
                              usageGrowth:
                                type: number
                                format: float
      operationId: getAdminCategoriesByid
    put:
      tags:
        - Admin - Categories
      summary: UCA03-3 - Update category
      description: Update category information
      security:
        - bearerAuth: []
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateCategoryRequest
      responses:
        "200":
          description: Category updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/Category
      operationId: updateAdminCategoriesByid
    delete:
      tags:
        - Admin - Categories
      summary: UCA03-4 - Delete category
      description: Delete category with recipe reassignment
      security:
        - bearerAuth: []
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: reassignTo
          in: query
          description: Category ID to reassign existing recipes to
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Category deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
      operationId: deleteAdminCategoriesByid
  /admin/ingredients:
    get:
      tags:
        - Admin - Categories
      summary: UCA03-5 - View ingredients list
      description: |
        Get standardized ingredients list for system management.

        **ERD Entities:** SYSTEM_INGREDIENT
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Ingredients retrieved successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/IngredientListResponse
      operationId: getAdminIngredients
    post:
      tags:
        - Admin - Categories
      summary: UCA03-6 - Create new ingredient
      description: Add new standardized ingredient to system
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateIngredientRequest
      responses:
        "201":
          description: Ingredient created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/SystemIngredient
      operationId: createAdminIngredients
  /admin/ingredients/{ingredientId}:
    get:
      tags:
        - Admin - Categories
      summary: Get ingredient details
      security:
        - bearerAuth: []
      parameters:
        - name: ingredientId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Ingredient details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/SystemIngredient
      operationId: getAdminIngredientsByid
    put:
      tags:
        - Admin - Categories
      summary: UCA03-7 - Update ingredient
      description: Update ingredient information
      security:
        - bearerAuth: []
      parameters:
        - name: ingredientId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateIngredientRequest
      responses:
        "200":
          description: Ingredient updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/SystemIngredient
      operationId: updateAdminIngredientsByid
    delete:
      tags:
        - Admin - Categories
      summary: UCA03-8 - Delete ingredient
      description: Delete ingredient from system
      security:
        - bearerAuth: []
      parameters:
        - name: ingredientId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Ingredient deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
      operationId: deleteAdminIngredientsByid
  /admin/accounts:
    get:
      tags:
        - Admin - System
      summary: UCA04-1 - View admin accounts list
      description: |
        Get list of all admin accounts with roles and permissions.
        Super Admin only endpoint.

        **ERD Entities:** ADMIN_ACCOUNT
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Admin accounts retrieved successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AdminAccountListResponse
      operationId: getAdminAccounts
    post:
      tags:
        - Admin - System
      summary: UCA04-2 - Create new admin account
      description: Create new admin account with role and permissions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ../components.yaml#/components/schemas/CreateAdminRequest
      responses:
        "201":
          description: Admin account created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/AdminAccount
      operationId: createAdminAccounts
  /admin/accounts/{accountId}:
    get:
      tags:
        - Admin - System
      summary: Get admin account details
      security:
        - bearerAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Admin account details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/AdminAccount
      operationId: getAdminAccountsByid
    put:
      tags:
        - Admin - System
      summary: Update admin account
      security:
        - bearerAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                role:
                  type: string
                  enum:
                    - admin
                    - moderator
                permissions:
                  type: array
                  items:
                    type: string
                isActive:
                  type: boolean
      responses:
        "200":
          description: Admin account updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/AdminAccount
      operationId: updateAdminAccountsByid
    delete:
      tags:
        - Admin - System
      summary: UCA04-4 - Delete admin account
      security:
        - bearerAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Admin account deleted successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/SuccessResponse
      operationId: deleteAdminAccountsByid
  /admin/accounts/{accountId}/permissions:
    put:
      tags:
        - Admin - System
      summary: UCA04-3 - Update admin permissions
      description: Update permissions for admin account
      security:
        - bearerAuth: []
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                permissions:
                  type: array
                  items:
                    type: string
              required:
                - permissions
      responses:
        "200":
          description: Permissions updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: ../components.yaml#/components/schemas/AdminAccount
      operationId: updateAdminAccountsByidPermissions
  /admin/audit-logs:
    get:
      tags:
        - Admin - System
      summary: Get system audit logs
      description: Get comprehensive audit trail of admin actions
      security:
        - bearerAuth: []
      parameters:
        - name: action
          in: query
          schema:
            type: string
        - name: actorId
          in: query
          schema:
            type: string
            format: uuid
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date-time
        - name: dateTo
          in: query
          schema:
            type: string
            format: date-time
        - $ref: ../components.yaml#/components/parameters/PageParam
        - $ref: ../components.yaml#/components/parameters/LimitParam
      responses:
        "200":
          description: Audit logs retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      auditLogs:
                        type: array
                        items:
                          $ref: ../components.yaml#/components/schemas/AuditLog
                      pagination:
                        $ref: ../components.yaml#/components/schemas/Pagination
      operationId: getAdminAuditLogs
  /admin/analytics/overview:
    get:
      tags:
        - Admin - Analytics
      summary: UCA05-1 - System overview analytics
      description: |
        Get comprehensive system analytics overview with key metrics.

        **ERD Entities:** Multiple entities for aggregated statistics
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum:
              - day
              - week
              - month
              - year
            default: month
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Analytics overview retrieved successfully
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AnalyticsResponse
      operationId: getAdminAnalyticsOverview
  /admin/analytics/users:
    get:
      tags:
        - Admin - Analytics
      summary: User analytics and statistics
      description: Detailed user metrics and growth analytics
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum:
              - growth
              - engagement
              - retention
              - demographics
        - name: period
          in: query
          schema:
            type: string
            enum:
              - day
              - week
              - month
              - year
            default: month
      responses:
        "200":
          description: User analytics retrieved
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AnalyticsResponse
      operationId: getAdminAnalyticsUsers
  /admin/analytics/recipes:
    get:
      tags:
        - Admin - Analytics
      summary: Recipe analytics and performance
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum:
              - creation
              - approval
              - engagement
              - categories
      responses:
        "200":
          description: Recipe analytics retrieved
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AnalyticsResponse
      operationId: getAdminAnalyticsRecipes
  /admin/analytics/engagement:
    get:
      tags:
        - Admin - Analytics
      summary: User engagement analytics
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum:
              - comments
              - ratings
              - favorites
              - sharing
      responses:
        "200":
          description: Engagement analytics retrieved
          content:
            application/json:
              schema:
                $ref: ../components.yaml#/components/schemas/AnalyticsResponse
      operationId: getAdminAnalyticsEngagement
security:
  - bearerAuth: []
externalDocs:
  description: Complete API Documentation & Guides
  url: https://docs.recipemanagement.com
x-api-id: recipe-management-api
x-audience: public
x-categories:
  - food
  - recipes
  - social
x-logo:
  url: https://recipemanagement.com/logo.png
  altText: Recipe Management System
x-explorer-enabled: true
x-samples-enabled: true
